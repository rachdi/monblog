/*! wiki-client - v0.8.1 - 2016-09-28
 * Copyright 2016 Ward Cunningham and other contributors;
 * Released under the MIT license */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){console.log("Window Name: "+window.name),window.name=window.location.host,window.wiki=a("./lib/wiki"),a("./lib/legacy"),a("./lib/bind"),a("./lib/plugins")},{"./lib/bind":5,"./lib/legacy":14,"./lib/plugins":24,"./lib/wiki":37}],2:[function(a,b,c){var d,e,f;f={create:"☼",add:"+",edit:"✎",fork:"⚑",move:"↕",remove:"✕"},e=f.fork,d=f.add,b.exports={symbols:f,fork:e,add:d}},{}],3:[function(a,b,c){var d,e,f;b.exports=d={},d.scrollContainer=void 0,e=function(){var a;return a=$("body, html").filter(function(){return $(this).scrollLeft()>0}),a.length>0?a:$("body, html").scrollLeft(12).filter(function(){return $(this).scrollLeft()>0}).scrollTop(0)},f=function(a){var b,c,f,g,h,i;if(null!=a.position())return null==d.scrollContainer&&(d.scrollContainer=e()),b=$("body").width(),g=d.scrollContainer.scrollLeft(),f=g+b,h=a.position().left,i=a.outerWidth(!0),c=$(".page").outerWidth(!0)*$(".page").length,h<g?d.scrollContainer.animate({scrollLeft:h}):h+i>f?d.scrollContainer.animate({scrollLeft:h-(b-i)}):f>$(".pages").outerWidth()?d.scrollContainer.animate({scrollLeft:Math.min(h,c-b)}):void 0},d.set=function(a){return a=$(a),$(".active").removeClass("active"),f(a.addClass("active"))}},{}],4:[function(a,b,c){var d,e;e=a("./util"),d=a("./actionSymbols"),b.exports=function(a,b){var c,f,g,h;if(f=a.parents(".page:first"),h="",null!=b.site&&(h+=b.site+"\n"),h+=b.type||"separator",null!=b.date&&(h+=" "+e.formatElapsedTime(b.date)),c=$('<a href="#" /> ').addClass("action").addClass(b.type||"separator").text(b.symbol||d.symbols[b.type]).attr("title",h).attr("data-id",b.id||"0").data("action",b),g=a.children(".control-buttons"),g.length>0?c.insertBefore(g):c.appendTo(a),"fork"===b.type&&null!=b.site)return c.css("background-image","url(//"+b.site+"/favicon.png)").attr("href","//"+b.site+"/"+f.attr("id")+".html").attr("target",""+b.site).data("site",b.site).data("slug",f.attr("id"))}},{"./actionSymbols":2,"./util":36}],5:[function(a,b,c){var d,e,f,g,h;e=a("./neighborhood"),f=a("./neighbors"),g=a("./searchbox"),h=a("./state"),d=a("./link"),$(function(){return g.inject(e),g.bind(),f.inject(e),f.bind(),window.seedNeighbors&&seedNeighbors.split(",").forEach(function(a){return e.registerNeighbor(a.trim())}),h.inject(d)})},{"./link":17,"./neighborhood":18,"./neighbors":19,"./searchbox":31,"./state":33}],6:[function(a,b,c){var d,e,f,g;g=a("./resolve"),d=null,e=function(){return d=$("<div></div>").html("This dialog will show every time!").dialog({autoOpen:!1,title:"Basic Dialog",height:600,width:800})},f=function(a,b){return d.html(b),d.dialog("option","title",g.resolveLinks(a)),d.dialog("open")},b.exports={emit:e,open:f}},{"./resolve":28}],7:[function(a,b,c){var d,e,f,g,h,i,j=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};i=a("url"),e=function(a){var b;return null!=(b=a.originalEvent.dataTransfer)&&j.call(b.types,"Files")>=0?b.files[0]:null},g=function(a){var b,c;return null!=(b=a.originalEvent.dataTransfer)&&null!=b.types&&(j.call(b.types,"text/uri-list")>=0||j.call(b.types,"text/x-moz-url")>=0)&&(c=b.getData("URL"),null!=c?c.length:void 0)?c:null},f=function(a){var b,c,d,e,f;return(b=a.match(/^http:\/\/([a-zA-Z0-9:.-]+)(\/([a-zA-Z0-9:.-]+)\/([a-z0-9-]+(_rev\d+)?))+$/))?(d={},c=b[0],e=b[1],c=b[2],d.site=b[3],d.slug=b[4],c=b[5],"view"!==(f=d.site)&&"local"!==f&&"origin"!==f||(d.site=e),d):null},h=function(a){var b,c;c=i.parse(a,!0,!0);try{"video"===c.query.source&&(c=i.parse(c.query.url,!0,!0))}catch(a){b=a}switch(c.hostname){case"www.youtube.com":return null!=c.query.list?{text:"YOUTUBE PLAYLIST "+c.query.list}:{text:"YOUTUBE "+c.query.v};case"youtu.be":return null!=c.query.list?{text:"YOUTUBE PLAYLIST "+c.query.list}:{text:"YOUTUBE "+c.pathname.substr(1)};case"vimeo.com":return{text:"VIMEO "+c.pathname.substr(1)};case"archive.org":return{text:"ARCHIVE "+c.pathname.substr(c.pathname.lastIndexOf("/")+1)};case"tedxtalks.ted.com":return{text:"TEDX "+c.pathname.substr(c.pathname.lastIndexOf("/")+1)};case"www.ted.com":return{text:"TED "+c.pathname.substr(c.pathname.lastIndexOf("/")+1)};default:return null}},d=function(a){return function(b){var c,d,i,j,k,l,m,n;if(l=function(a){return b.preventDefault(),b.stopPropagation()},m=g(b)){if((i=f(m))&&null!=(d=a.page))return l(d(i));if((n=h(m))&&null!=(d=a.video))return l(d(n));j={url:m}}if(c=e(b)){if(null!=(d=a.file))return l(d(c));j={file:c}}if(null!=(d=a.punt))return j||(j={dt:b.dataTransfer,types:null!=(k=b.dataTransfer)?k.types:void 0}),l(d(j))}},b.exports={dispatch:d}},{url:43}],8:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m;i=a("./plugin"),f=a("./itemz"),h=a("./pageHandler"),g=a("./link"),j=a("./random"),d=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},m=function(a,b,c){var j,n,o,p,q,r;if(null==c&&(c={}),console.log("textEditor",b.id,c),o=function(d){var h,i,k,n,o,p,q,r,s;if((d.altKey||d.ctlKey||d.metaKey)&&83===d.which)return j.focusout(),!1;if((d.altKey||d.ctlKey||d.metaKey)&&73===d.which)return d.preventDefault(),d.shiftKey||(n=$(d.target).parents(".page")),g.doInternalLink("about "+b.type+" plugin",n),!1;if("paragraph"===b.type){if(q=e(j),d.which===$.ui.keyCode.BACKSPACE&&0===q.start&&q.start===q.end)return i=a.prev(),p=f.getItem(i),"paragraph"===p.type&&(k=p[c.field||"text"].length,r=j.val(),j.val(""),m(i,p,{caret:k,suffix:r}),!1);if(d.which===$.ui.keyCode.ENTER)return!!q&&(h=a.parents(".page"),s=j.val(),o=s.substring(0,q.start),r=s.substring(q.end),""===o?(j.val(r),j.focusout(),l(h,a.prev(),o,!0)):(j.val(o),j.focusout(),l(h,a,r)),!1)}},n=function(){var d;if(a.removeClass("textEditing"),j.unbind(),d=a.parents(".page:first"),b[c.field||"text"]=j.val())if(i.do(a.empty(),b),c.after){if(""===b[c.field||"text"])return;h.put(d,{type:"add",id:b.id,item:b,after:c.after})}else{if(b[c.field||"text"]===p)return;h.put(d,{type:"edit",id:b.id,item:b})}else c.after||h.put(d,{type:"remove",id:b.id}),a.remove();return null},!a.hasClass("textEditing"))return a.addClass("textEditing"),a.unbind(),p=null!=(q=b[c.field||"text"])?q:"",j=$("<textarea>"+d(p)+d(null!=(r=c.suffix)?r:"")+"</textarea>").focusout(n).bind("keydown",o),a.html(j),c.caret?k(j,c.caret):c.append?(k(j,j.val().length),j.scrollTop(j[0].scrollHeight-j.height())):j.focus()},l=function(a,b,c){var d,e,g;return g={type:"paragraph",id:j.itemId(),text:c},d=$('<div class="item paragraph" data-id='+g.id+"></div>"),d.data("item",g).data("pageElement",a),b.after(d),i.do(d,g),e=f.getItem(b),m(d,g,{after:null!=e?e.id:void 0})},e=function(a){var b,c,d;return b=a.get(0),document.selection?(b.focus(),d=document.selection.createRange(),d.moveStart("character",-b.value.length),c=d.text.length,{start:c,end:c}):{start:b.selectionStart,end:b.selectionEnd}},k=function(a,b){var c,d;if(c=a.get(0),null!=c)return c.createTextRange?(d=c.createTextRange(),d.move("character",b),d.select()):c.setSelectionRange(b,b),c.focus()},b.exports={textEditor:m}},{"./itemz":13,"./link":17,"./pageHandler":21,"./plugin":23,"./random":25}],9:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q;l=a("./neighborhood"),n=a("./plugin"),p=a("./resolve"),m=a("./pageHandler"),i=a("./editor"),q=a("./synopsis"),h=a("./drop"),d=a("./active"),k=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")},j=function(a,b){var c,e;return a.append("<p>Double-Click to Edit<br>Drop Text or Image to Insert</p>"),c=function(){var c,e,f,g,h,j;for(h=a.find("p").append('<br>Or Choose a Plugin\n<center>\n<table style="text-align:left;">\n<tr><td><ul id=format><td><ul id=data><td><ul id=other>'),j=window.catalog,e=0,g=j.length;e<g;e++)f=j[e],c=f.category||"other","format"!==c&&"data"!==c&&(c="other"),h.find("#"+c).append('<li><a class="menu" href="#" title="'+f.title+'">'+f.name+"</a></li>");return h.find("a.menu").click(function(c){return a.removeClass("factory").addClass(b.type=c.target.text.toLowerCase()),a.unbind(),c.preventDefault(),d.set(a.parents(".page")),i.textEditor(a,b)})},e=function(){return a.append("<p>"+p.resolveLinks(b.prompt,k)+"</b>")},b.prompt?e():null!=window.catalog?c():$.getJSON("/system/factories.json",function(a){return window.catalog=a,c()})},f=function(a,b){var c,d,f,j,k;return k=function(){var c,d;a.empty().unbind(),a.removeClass("factory").addClass(b.type),c=a.parents(".page:first");try{a.data("pageElement",c),a.data("item",b),n.getPlugin(b.type,function(c){return c.emit(a,b),c.bind(a,b)})}catch(b){d=b,a.append("<p class='error'>"+d+"</p>")}return m.put(c,{type:"edit",id:b.id,item:b})},f=function(a){return b.prompt="Unexpected Item\nWe can't make sense of the drop.\nTry something else or see [[About Factory Plugin]].",a.userAgent=navigator.userAgent,b.punt=a,k()},c=function(a){return $.getJSON("http://"+a.site+"/"+a.slug+".json",function(c){if(b.type="reference",b.site=a.site,b.slug=a.slug,b.title=c.title||a.slug,b.text=q(c),k(),null!=b.site)return l.registerNeighbor(b.site)})},d=function(a){return b.type="video",b.text=a.text+"\n(double-click to edit caption)\n",k()},j=function(a){var c,d,h,i;if(null!=a)return i=a.type.split("/"),c=i[0],d=i[1],h=new FileReader,"image"===c?(h.onload=function(a){return b.type="image",b.url=o(a.target.result),b.caption||(b.caption="Uploaded image"),k()},h.readAsDataURL(a)):"text"===c?(h.onload=function(c){var f,h;return h=c.target.result,"csv"===d?(b.type="data",b.columns=(f=g(h))[0],b.data=e(f),b.text=a.fileName):(b.type="paragraph",b.text=h),k()},h.readAsText(a)):f({name:a.name,type:a.type,size:a.size,fileName:a.fileName,lastModified:a.lastModified})},a.dblclick(function(c){return c.shiftKey?i.textEditor(a,b,{field:"prompt"}):(a.removeClass("factory").addClass(b.type="paragraph"),a.unbind(),i.textEditor(a,b))}),a.bind("dragenter",function(a){return a.preventDefault()}),a.bind("dragover",function(a){return a.preventDefault()}),a.bind("drop",h.dispatch({page:c,file:j,video:d,punt:f}))},g=function(a,b){var c,d,e,f,g;for(b=b||",",e=new RegExp("(\\"+b+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+b+"\\r\\n]*))","gi"),c=[[]],d=null;d=e.exec(a);)f=d[1],f.length&&f!==b&&c.push([]),g=d[2]?d[2].replace(new RegExp('""',"g"),'"'):d[3],c[c.length-1].push(g);return c},e=function(a){var b,c,d,e,f,g;for(b=a.shift(),g=function(a){var c,d,e,f,g,h,i;for(f={},g=_.zip(b,a),c=0,e=g.length;c<e;c++)h=g[c],d=h[0],i=h[1],null!=i&&i.match(/\S/)&&"NULL"!==i&&(f[d]=i);return f},e=[],c=0,d=a.length;c<d;c++)f=a[c],e.push(g(f));return e},o=function(a){var b,c,d;return c=function(a){return a.width<=500||a.height<=300},d=function(a){var b,e,f,g;return c(a)?a:(f=document.createElement("canvas"),f.width=e=a.width/2,f.height=b=a.height/2,g=f.getContext("2d"),g.drawImage(a,0,0,e,b),d(f))},b=new Image,b.src=a,c(b)?a:d(b).toDataURL("image/jpeg",.5)},b.exports={emit:j,bind:f}},{"./active":3,"./drop":7,"./editor":8,"./neighborhood":18,"./pageHandler":21,"./plugin":23,"./resolve":28,"./synopsis":34}],10:[function(a,b,c){var d,e,f,g,h,i;i=a("./resolve"),g=a("./neighborhood"),f=a("./lineup"),h=a("./refresh"),e=function(a,b){var c,d,e,f,h,j,k,l;if(a.append(b.text+'<br><br><button class="create">create</button> new blank page'),(l=null!=(f=b.create)&&null!=(h=f.source)?h.transport:void 0)&&(a.append('<br><button class="transport" data-slug='+b.slug+">create</button> transport from "+l),a.append("<p class=caption> unavailable</p>"),$.get("http://localhost:4020",function(){return a.find(".caption").text("ready")})),null!=(d=g.sites[location.host])&&null!=d.sitemap){for(j=d.sitemap,k=[],c=0,e=j.length;c<e;c++)b=j[c],b.slug.match(/-template$/)?k.push(a.append('<br><button class="create" data-slug='+b.slug+">create</button> from "+i.resolveLinks("[["+b.title+"]]"))):k.push(void 0);return k}},d=function(a,b){return a.find("button.transport").click(function(c){var d,e;return a.find(".caption").text("waiting"),d={title:a.parents(".page").data("data").title,create:b.create},e={type:"POST",url:b.create.source.transport,dataType:"json",contentType:"application/json",data:JSON.stringify(d)},$.ajax(e).done(function(b){var c,d,e;return a.find(".caption").text("ready"),e=wiki.newPage(b),c=a.parents(".page"),d=f.atKey(c.data("key")),d.become(e,e),b=d.getRawPage(),h.rebuildPage(d,c.empty())})})},b.exports={emit:e,bind:d}},{"./lineup":15,"./neighborhood":18,"./refresh":27,"./resolve":28}],11:[function(a,b,c){var d,e,f,g,h,i,j;e=a("./dialog"),f=a("./editor"),j=a("./resolve"),i=!1,h="http://localhost:8080",$.ajax(h+"/ipfs/Qmb1oS3TaS8vekxXqogoYsixe47sXcVxQ22kPWH8VSd7yQ",{timeout:3e4,success:function(a){return i="wiki\n"===a},complete:function(a,b){return console.log("ipfs gateway "+b)}}),g=function(a,b){return b.text||(b.text=b.caption),a.append('<img class=thumbnail src="'+b.url+'"> <p>'+j.resolveLinks(b.text)+"</p>")},d=function(a,b){return a.dblclick(function(){return f.textEditor(a,b)}),a.find("img").dblclick(function(a){var c;return a.stopPropagation(),c=i&&null!=b.ipfs?h+"/ipfs/"+b.ipfs:b.url,e.open(b.text,'<img style="width:100%" src="'+c+'">')})},b.exports={emit:g,bind:d}},{"./dialog":6,"./editor":8,"./resolve":28}],12:[function(a,b,c){var d,e,f,g,h,i;i=a("./util"),g=a("./link"),h=a("./page").newPage,f=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},e=function(a,b){var c;return c=function(a){var b,c,d,e,g;e=[];for(g in a)d=a[g],c="<a href="+g+">"+(f(d.title)||g)+"</a>",d.journal&&(c+=(b=d.journal[d.journal.length-1].date)?" &nbsp; from "+i.formatElapsedTime(b):" &nbsp; from revision "+(d.journal.length-1)),e.push(c);return e.join("<br>")},a.append('<p style="background-color:#eee;padding:15px;">\n  '+c(b.pages)+"\n</p>")},d=function(a,b){return a.find("a").click(function(a){var c,d,e;return e=$(a.target).attr("href"),a.shiftKey||(c=$(a.target).parents(".page")),d=h(b.pages[e]),g.showResult(d,{$page:c,rev:d.getRevision()}),!1})},b.exports={emit:e,bind:d}},{"./link":17,"./page":20,"./util":36}],13:[function(a,b,c){var d,e,f,g,h,i,j,k;f=a("./pageHandler"),g=a("./plugin"),h=a("./random"),k=function(a,b){return setTimeout(b,a)},e=function(a){if($(a).length>0)return $(a).data("item")||$(a).data("staticItem")},i=function(a,b){return f.put(a.parents(".page:first"),{type:"remove",id:b.id}),a.remove()},d=function(a,b,c){var d,i;return null==a&&(a=b.parents(".page")),c.id=h.itemId(),d=$('<div class="item '+c.type+'" data-id=""</div>'),d.data("item",c).data("pageElement",a),null!=b?b.after(d):a.find(".story").append(d),g.do(d,c),i=e(b),k(500,function(){return f.put(a,{item:c,id:c.id,type:"add",after:null!=i?i.id:void 0})}),d},j=function(a,b,c){var d,e,h;h=$.extend({},c),a.empty().unbind(),a.removeClass(b).addClass(h.type),d=a.parents(".page:first");try{a.data("pageElement",d),a.data("item",h),g.getPlugin(c.type,function(b){return b.emit(a,h),b.bind(a,h)})}catch(b){e=b,a.append("<p class='error'>"+e+"</p>")}return f.put(d,{type:"edit",id:h.id,item:h})},b.exports={createItem:d,removeItem:i,getItem:e,replaceItem:j}},{"./pageHandler":21,"./plugin":23,"./random":25}],14:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;k=a("./pageHandler"),m=a("./state"),d=a("./active"),l=a("./refresh"),h=a("./lineup"),g=a("./drop"),f=a("./dialog"),i=a("./link"),n=a("./target"),e=a("./page").asSlug,j=a("./page").newPage,$(function(){var b,c,e,o,p,q,r;return f.emit(),b=37,c=39,$(document).keydown(function(a){var e,f,g;if(e=function(){switch(a.which){case b:return-1;case c:return 1}}(),e&&"TEXTAREA"!==a.target.tagName&&(g=$(".page"),f=g.index($(".active"))+e,0<=f&&f<g.length))return d.set(g.eq(f))}),$(window).on("popstate",m.show),$(document).ajaxError(function(a,b,c){if(0!==b.status&&404!==b.status)return console.log("ajax error",a,b,c)}),e=function(a){return(""+a).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")},r=function(a){var b;if("application/json"===(null!=a?a.type:void 0))return b=new FileReader,b.onload=function(b){var c,d,f;return d=b.target.result,c=JSON.parse(d),f=j(),f.setTitle("Import from "+a.name),f.addParagraph("Import of "+Object.keys(c).length+" pages\n("+e(a.size)+" bytes)\nfrom an export file dated "+a.lastModifiedDate+"."),f.addItem({type:"importer",pages:c}),i.showResult(f)},b.readAsText(a)},p=function(a,b){return a?(console.log("getTemplate",a),k.get({whenGotten:function(a,c){return b(a)},whenNotGotten:function(){return b(null)},pageInformation:{slug:a}})):b(null)},o=function(a,b){var c;return a.preventDefault(),a.shiftKey||(c=$(a.target).parents(".page")),i.doInternalLink(b,c,$(a.target).data("site")),!1},$(".main").delegate(".show-page-source","click",function(a){var b,c;return a.preventDefault(),b=$(this).parents(".page"),c=h.atKey(b.data("key")).getRawPage(),f.open("JSON for "+c.title,$("<pre/>").text(JSON.stringify(c,null,2)))}).delegate(".page","click",function(a){if(!$(a.target).is("a"))return d.set(this)}).delegate(".internal","click",function(a){var b;return b=$(a.target).data("pageName"),b=""+b,k.context=$(a.target).attr("title").split(" => "),o(a,b)}).delegate("img.remote","click",function(a){var b;return b=$(a.target).data("slug"),k.context=[$(a.target).data("site")],o(a,b)}).delegate(".revision","dblclick",function(a){var b,c,d,e,g;return a.preventDefault(),b=$(this).parents(".page"),e=h.atKey(b.data("key")).getRawPage(),g=e.journal.length-1,c=e.journal[g],d=JSON.stringify(c,null,2),f.open("Revision "+g+", "+c.type+" action",$("<pre/>").text(d))}).delegate(".action","click",function(a){var b,c,e,f,g,j;return a.preventDefault(),b=$(a.target),b.is(".fork")&&null!=(f=b.data("slug"))?(k.context=[b.data("site")],o(a,f.split("_")[0])):(c=$(this).parents(".page"),e=c.data("key"),j=h.atKey(e).getSlug(),g=$(this).parent().children().not(".separator").index(b),g<0?void 0:(a.shiftKey||c.nextAll().remove(),a.shiftKey||h.removeAllAfterKey(e),i.createPage(j+"_rev"+g,c.data("site")).appendTo($(".main")).each(l.cycle),d.set($(".page").last())))}).delegate(".fork-page","click",function(a){var b,c,d;if(b=$(a.target).parents(".page"),!b.find(".future").length){if(d=h.atKey(b.data("key")),c={type:"fork"},b.hasClass("local")){if(k.useLocalStorage())return;b.removeClass("local")}else d.isRemote()&&(c.site=d.getRemoteSite());return null!=b.data("rev")&&b.find(".revision").remove(),b.removeClass("ghost"),k.put(b,c)}}).delegate("button.create","click",function(a){return p($(a.target).data("slug"),function(b){var c,d,e;return c=$(a.target).parents(".page:first"),c.removeClass("ghost"),e=h.atKey(c.data("key")),e.become(b),d=e.getRawPage(),l.rebuildPage(e,c.empty()),k.put(c,{type:"create",id:d.id,item:{title:d.title,story:d.story}})})}).delegate(".score","mouseenter mouseleave",function(a){return console.log("in .score..."),$(".main").trigger("thumb",$(a.target).data("thumb"))}).delegate("a.search","click",function(a){var b,c,d,e,f;return b=$(a.target).parents(".page"),d=b.data("key"),e=h.atKey(d),f=j(),f.setTitle("Search from '"+e.getTitle()+"'"),f.addParagraph("Search for pages related to '"+e.getTitle()+"'.\nEach search on this page will find pages related in a different way.\nChoose the search of interest. Be patient."),f.addParagraph("Find pages with links to this title."),f.addItem({type:"search",text:"SEARCH LINKS "+e.getSlug()}),f.addParagraph("Find pages neighboring  this site."),f.addItem({type:"search",text:"SEARCH SITES "+e.getRemoteSite(location.host)}),f.addParagraph("Find pages sharing any of these items."),f.addItem({type:"search",text:"SEARCH ANY ITEMS "+function(){var a,b,d,f;for(d=e.getRawPage().story,f=[],a=0,b=d.length;a<b;a++)c=d[a],f.push(c.id);return f}().join(" ")}),a.shiftKey||b.nextAll().remove(),a.shiftKey||h.removeAllAfterKey(d),i.showResult(f)}).bind("dragenter",function(a){return a.preventDefault()}).bind("dragover",function(a){return a.preventDefault()}).bind("drop",g.dispatch({page:function(a){return i.doInternalLink(a.slug,null,a.site)},file:function(a){return r(a)}})),$(".provider input").click(function(){return $("footer input:first").val($(this).attr("data-provider")),$("footer form").submit()}),$("body").on("new-neighbor-done",function(a,b){return $(".page").each(function(a,b){return l.emitTwins($(b))})}),q=a("./lineupActivity"),$("<span class=menu> &nbsp; &equiv; &nbsp; </span>").css({cursor:"pointer","font-size":"120%"}).appendTo("footer").click(function(){return f.open("Lineup Activity",q.show())}),n.bind(),$(function(){return m.first(),$(".page").each(l.cycle),d.set($(".page").last())})})},{"./active":3,"./dialog":6,"./drop":7,"./lineup":15,"./lineupActivity":16,"./link":17,"./page":20,"./pageHandler":21,"./refresh":27,"./state":33,"./target":35}],15:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};n=a("./random"),m={},k=[],d=function(a){var b;return b=n.randomBytes(4),m[b]=a,k.push(b),b},p=function(a){return r.call(k,a)<0?null:(k=k.filter(function(b){return a!==b}),delete m[a],a)},o=function(a){var b,c;if(b=[],r.call(k,a)<0)return b;for(;k[k.length-1]!==a;)c=k.pop(),b.unshift(c),delete m[c];return b},e=function(a){return m[a]},q=function(a){return e(a).getTitle()},f=function(){return k.length?q(k[k.length-1]):"Wiki"},h=function(){return k},i=function(){return m={},k=[]},j=function(a){var b,c,d;if((b=""+k)!=(d=""+a)&&(console.log("The lineup is out of sync with the dom."),console.log(".pages:",a),console.log("lineup:",k),""+Object.keys(k).sort()==""+Object.keys(a).sort()))return console.log("It looks like an ordering problem we can fix."),c=a},l=function(a){var b;return b=k.indexOf(a),b<1?null:k[b-1]},g=function(a,b){var c,d,e,f,g,h;return f=m[a],d=f.getRemoteSite(b),g=["view",h=f.getSlug()],"welcome-visitors"!==h&&g.unshift("view","welcome-visitors"),d!==b&&null!=(e=l(a))&&((c=m[e]).isRemote()||g.push(b,c.getSlug())),g.unshift(d),g},b.exports={addPage:d,removeKey:p,removeAllAfterKey:o,atKey:e,titleAtKey:q,bestTitle:f,debugKeys:h,debugReset:i,crumbs:g,debugSelfCheck:j}},{"./random":25}],16:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m;g=a("./lineup"),e=24*(f=60*(h=60*(j=1e3))),d=function(a,b,c){var d,e,f;for(e=0,f=a.length;e<f;e++)if(d=a[e],null!=d.date&&b<d.date&&d.date<=c)return!0;return!1},l=function(a){var b,c,f,g,h;for(g="",b=60,c=(new Date).getTime()-b*e,f=1,h=b;1<=h?f<=h:f>=h;1<=h?f++:f--)g+=d(a,c,c+e)?"|":".",5===new Date(c).getDay()&&(g+="<td>"),c+=e;return g},i=function(a){var b,c;return b=a.getRemoteSite(location.host),c=a.getTitle(),"<tr><td align=right>\n  "+l(a.getRawPage().journal)+'\n<td>\n  <img class="remote" src="//'+b+'/favicon.png">\n  '+c},m=function(a){var b;return"<table>\n"+function(){var c,d,e;for(e=[],c=0,d=a.length;c<d;c++)b=a[c],e.push(i(g.atKey(b)));return e}().join("\n")+'\n</table>\n<p style="color: #bbb">dots are days, advancing to the right, with marks showing activity</p>'},k=function(){return m(g.debugKeys())},b.exports={show:k}},{"./lineup":15}],17:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;i=a("./lineup"),d=a("./active"),l=a("./refresh"),k=a("./page"),f=k.asTitle,e=k.asSlug,j=k.pageEmitter,g=function(a,b){var c,d,e;return b&&"view"!==b&&(d=b),e=f(a),c=$('<div class="page" id="'+a+'">\n  <div class="paper">\n    <div class="twins"> <p> </p> </div>\n    <div class="header">\n      <h1> <img class="favicon" src="'+(d?"//"+d:"")+'/favicon.png" height="32px"> '+e+" </h1>\n    </div>\n  </div>\n</div>"),d&&c.data("site",d),c},m=function(a,b){return g(a,b).appendTo(".main").each(l.cycle)},h=function(a,b,c){return null==c&&(c=null),a=e(a),null!=b&&$(b).nextAll().remove(),null!=b&&i.removeAllAfterKey($(b).data("key")),m(a,c),d.set($(".page").last())},n=function(a,b){var c,e;return null==b&&(b={}),null!=b.$page&&$(b.$page).nextAll().remove(),null!=b.$page&&i.removeAllAfterKey($(b.$page).data("key")),e=a.getSlug(),null!=b.rev&&(e+="_rev"+b.rev),c=g(e).addClass("ghost"),c.appendTo($(".main")),l.buildPage(a,c),d.set($(".page").last())},j.on("show",function(a){return console.log("pageEmitter handling",a),n(a)}),b.exports={createPage:g,doInternalLink:h,showPage:m,showResult:n}},{"./active":3,"./lineup":15,"./page":20,"./refresh":27}],18:[function(a,b,c){var d,e,f,g,h,i={}.hasOwnProperty;d=a("underscore"),b.exports=e={},e.sites={},f=0,g=500,h=function(a,b){var c,d,e;if(!b.sitemapRequestInflight)return b.sitemapRequestInflight=!0,e=function(a,b,c){return $('.neighbor[data-site="'+a+'"]').find("div").removeClass(b).addClass(c)},c=function(){var c,d;return d="http://"+a+"/system/sitemap.json",e(a,"wait","fetch"),c=$.ajax({type:"GET",dataType:"json",url:d}),c.always(function(){return b.sitemapRequestInflight=!1}).done(function(c){return b.sitemap=c,e(a,"fetch","done"),$("body").trigger("new-neighbor-done",a)}).fail(function(b){return e(a,"fetch","fail")})},d=Date.now(),d>f?(f=d+g,setTimeout(c,100)):(setTimeout(c,f-d),f+=g)},e.registerNeighbor=function(a){var b;if(null==e.sites[a])return b={},e.sites[a]=b,h(a,b),$("body").trigger("new-neighbor",a)},e.updateSitemap=function(a){var b,c,d,f,g,h,i,j,k;if(g=location.host,(f=e.sites[g])&&!f.sitemapRequestInflight)return i=a.getSlug(),b=a.getDate(),k=a.getTitle(),j=a.getSynopsis(),c={slug:i,date:b,title:k,synopsis:j},h=f.sitemap,d=h.findIndex(function(a){return a.slug===i}),d>=0?h[d]=c:h.push(c),$("body").trigger("new-neighbor-done",g)},e.listNeighbors=function(){return d.keys(e.sites)},e.search=function(a){var b,c,f,g,h,j,k,l,m,n;b=[],m={},n=function(a){return null!=m[a]?m[a]++:m[a]=1},c=function(b,c){var d;return d=null!=c&&c.toLowerCase().indexOf(a.toLowerCase())>=0,d&&n(b),d},l=Date.now(),j=e.sites;for(h in j)i.call(j,h)&&(g=j[h],k=g.sitemap,null!=k&&n("sites"),f=d.each(k,function(a){if(n("pages"),c("title",a.title)||c("text",a.synopsis)||c("slug",a.slug))return n("finds"),b.push({page:a,site:h,rank:1})}));return m.msec=Date.now()-l,{finds:b,tally:m}}},{underscore:45}],19:[function(a,b,c){var d,e,f,g,h,i;g=a("./link"),h=null,i=0,e=function(a){return'<span class="neighbor" data-site="'+a+'">\n  <div class="wait">\n    <img src="http://'+a+'/favicon.png" title="'+a+'">\n  </div>\n</span>'},f=function(a){return h=a.sites},d=function(){var a;return a=$(".neighborhood"),$("body").on("new-neighbor",function(b,c){return a.append(e(c))}).on("new-neighbor-done",function(a,b){var c,d;return d=h[b].sitemap.length,c=$('.neighborhood .neighbor[data-site="'+b+'"]').find("img"),c.attr("title",b+"\n "+d+" pages"),i+=d,$(".searchbox .pages").text(i+" pages")}).delegate(".neighbor img","click",function(a){return g.doInternalLink("welcome-visitors",null,this.title.split("\n")[0])})},b.exports={inject:f,bind:d}},{"./link":17}],20:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;h=a("./util").formatDate,l=a("./random"),m=a("./revision"),n=a("./synopsis"),e=a("underscore"),d=a("events").EventEmitter,k=new d,f=function(a){return a.replace(/\s/g,"-").replace(/[^A-Za-z0-9-]/g,"").toLowerCase()},g=function(a){return a.replace(/-/g," ")},j=function(a){return[{symbol:"❄",date:a-316224e5,period:"a Year"},{symbol:"⚘",date:a-80352e5,period:"a Season"},{symbol:"⚪",date:a-26784e5,period:"a Month"},{symbol:"☽",date:a-6048e5,period:"a Week"},{symbol:"☀",date:a-864e5,period:"a Day"},{symbol:"⌚",date:a-36e5,period:"an Hour"}]},i=function(a,b){var c,d,g,k,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K;return G=a||{},G.title||(G.title="empty"),G.story||(G.story=[]),G.journal||(G.journal=[]),t=function(){return G},o=function(){var a,c,d,f,g,h;for(d=["view"],D()&&d.push(b),c=function(a){if(null!=a&&!e.include(d,a))return d.push(a)},h=G.journal.slice(0).reverse(),f=0,g=h.length;f<g;f++)a=h[f],c(null!=a?a.site:void 0);return d},C=function(){return null!=G.plugin},D=function(){return!(void 0===b||null===b||"view"===b||"origin"===b||"local"===b)},B=function(){return"local"===b},u=function(a){return null==a&&(a=null),D()?b:a},v=function(a){var b;return null==a&&(a=null),b=[],(a||D())&&b.push(u(a)),C()&&b.push(G.plugin+" plugin"),b.join("\n")},x=function(){return f(G.title)},s=function(a){var c,d,f,g,h,i,j,k,l;for(j=[],D()?j.push(b):null!=a&&j.push(a),k=G.story,f=0,h=k.length;f<h;f++)d=k[f],null!=(null!=d?d.site:void 0)&&j.push(d.site);for(l=G.journal,g=0,i=l.length;g<i;g++)c=l[g],null!=(null!=c?c.site:void 0)&&j.push(c.site);return e.uniq(j)},A=function(){return G.title},J=function(a){return G.title=a},w=function(){return G.journal.length-1},q=function(){var a;if(a=G.journal[w()],null!=a&&null!=a.date)return a.date},z=function(){var a;return a=G.journal[w()],null!=a?null!=a.date?h(a.date):"Revision "+w():"Unrecorded Date"},y=function(){return n(G)},c=function(a){return a=e.extend({},{id:l.itemId()},a),G.story.push(a)},r=function(a){var b,c,d,e;for(e=G.story,c=0,d=e.length;c<d;c++)if(b=e[c],b.id===a)return b;return null},I=function(a){var b;return(b=function(c){if(!(c>=G.story.length))return a(G.story[c]||{text:"null"},function(){return b(c+1)})})(0)},d=function(a){var b;return b="paragraph",c({type:b,text:a})},H=function(a){var b,c,d;return d=0,c=j((new Date).getTime()),(b=function(e){var f,g,h,i,j,k;if(!(e>=G.journal.length)){for(f=G.journal[e]||{},g=f.date||0,k=null,h=0,i=c.length;h<i;h++)j=c[h],j.date>d&&j.date<g&&(k=j);return d=g,a({action:f,separator:k},function(){return b(e+1)})}})(0)},k=function(a,b){if(G.story=(null!=a?a.getRawPage().story:void 0)||[],null!=b)return G.journal=null!=b?b.getRawPage().journal:void 0},K=function(){var a,c;return c=x(),a="welcome-visitors"===c?"view/welcome-visitors":"view/welcome-visitors/view/"+c,D()?"//"+b+"/"+a:"/"+a},F=function(a,b){var c,d,e;for(d=0,e=a.length;d<e;d++)if(c=a[d],c.id===b.id&&c.date===b.date)return!1;return!0},E=function(a){var c,d,e,f,g;for(f=function(){var a,b,d,e;for(d=G.journal,e=[],a=0,b=d.length;a<b;a++)c=d[a],e.push(c);return e}(),g=a.getRawPage().journal,d=0,e=g.length;d<e;d++)c=g[d],F(G.journal,c)&&f.push(c);return f.push({type:"fork",site:a.getRemoteSite(),date:(new Date).getTime()}),i(m.create(999,{title:G.title,journal:f}),b)},g=function(a){if(m.apply(G,a),a.site)return b=null},p=function(){var a;return a=function(a){return"create"===a.type},G.journal.reverse().find(a)},{getRawPage:t,getContext:o,isPlugin:C,isRemote:D,isLocal:B,getRemoteSite:u,getRemoteSiteDetails:v,getSlug:x,getNeighbors:s,getTitle:A,setTitle:J,getRevision:w,getDate:q,getTimestamp:z,getSynopsis:y,addItem:c,getItem:r,addParagraph:d,seqItems:I,seqActions:H,become:k,siteLineup:K,merge:E,apply:g,getCreate:p}},b.exports={newPage:i,asSlug:f,asTitle:g,pageEmitter:k}},{"./random":25,"./revision":29,"./synopsis":34,"./util":36,events:38,underscore:45}],21:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q;d=a("underscore"),q=a("./state"),p=a("./revision"),e=a("./addToJournal"),i=a("./page").newPage,n=a("./random"),g=a("./lineup"),h=a("./neighborhood"),b.exports=k={},f=function(a){return JSON.parse(JSON.stringify(a))},k.useLocalStorage=function(){return $(".login").length>0},j=function(a){var b;return(b=localStorage.getItem(a))?JSON.parse(b):void 0},o=function(a){var b,c,d,e,f,g,h,k,l;if(d=a.pageInformation,k=a.whenGotten,l=a.whenNotGotten,b=a.localContext,g=d.slug,e=d.rev,f=d.site,f?b=[]:f=b.shift(),f===window.location.host&&(f="origin"),"view"===f&&(f=null),null!=f){if("local"===f)return(c=j(d.slug))?k(i(c,"local")):l();h="origin"===f?"/"+g+".json":"http://"+f+"/"+g+".json"}else h="/"+g+".json";return $.ajax({type:"GET",dataType:"json",url:h+("?random="+n.randomBytes(4)),success:function(a){return e&&(a=p.create(e,a)),k(i(a,f))},error:function(a,c,e){var f;return 404!==a.status&&0!==a.status?(console.log("pageHandler.get error",a,a.status,c,e),f=i({title:"Trouble: Can't Get Page"},null),f.addItem({type:"html",text:"The page handler has run into problems with this   request.\n<pre class=error>"+JSON.stringify(d)+"</pre>\nThe requested url.\n<pre class=error>"+h+"</pre>\nThe server reported status.\n<pre class=error>"+a.status+"</pre>\nThe error type.\n<pre class=error>"+c+"</pre>\nThe error message.\n<pre class=error>"+e+"</pre>\nThese problems are rarely solved by reporting issues.\nThere could be additional information reported in the browser's console.log.\nMore information might be accessible by fetching the page outside of wiki.\n<a href=\""+h+'" target="_blank">try-now</a>'
}),k(f)):b.length>0?o({pageInformation:d,whenGotten:k,whenNotGotten:l,localContext:b}):l()}})},k.get=function(a){var b,c,e,f;return e=a.whenGotten,f=a.whenNotGotten,c=a.pageInformation,!c.site&&(b=j(c.slug))?(c.rev&&(b=p.create(c.rev,b)),e(i(b,"local"))):(k.context.length||(k.context=["view"]),o({pageInformation:c,whenGotten:e,whenNotGotten:f,localContext:d.clone(k.context)}))},k.context=[],l=function(a,b,c){var d,f;return"create"===c.type?d={title:c.item.title,story:[],journal:[]}:(d=j(b.slug),d||(d=g.atKey(a.data("key")).getRawPage()),null==d.journal&&(d.journal=[]),null!=(f=c.fork)&&(d.journal=d.journal.concat({type:"fork",site:f,date:(new Date).getTime()}),delete c.fork)),p.apply(d,c),localStorage.setItem(b.slug,JSON.stringify(d)),e(a.find(".journal"),c),a.addClass("local")},m=function(a,b,c){var d,i;return d=f(c),i=g.atKey(a.data("key")),"fork"===c.type&&(d.item=f(i.getRawPage())),$.ajax({type:"PUT",url:"/page/"+b.slug+"/action",data:{action:JSON.stringify(d)},success:function(){if((null!=i?i.apply:void 0)&&i.apply(c),h.updateSitemap(i),e(a.find(".journal"),c),"fork"===c.type)return localStorage.removeItem(a.attr("id"))},error:function(d,e,f){return c.error={type:e,msg:f,response:d.responseText},l(a,b,c)}})},k.put=function(a,b){var c,d,f;return c=function(){var b;switch(b=a.data("site")){case"origin":case"local":case"view":return null;case location.host:return null;default:return b}},f={slug:a.attr("id").split("_rev")[0],rev:a.attr("id").split("_rev")[1],site:c(),local:a.hasClass("local")},d=f.site,console.log("pageHandler.put",b,f),k.useLocalStorage()&&(null!=f.site?console.log("remote => local"):f.local||(console.log("origin => local"),b.site=d=location.host)),b.date=(new Date).getTime(),"origin"===b.site&&delete b.site,d&&(a.find("h1").prop("title",location.host),a.find("h1 img").attr("src","/favicon.png"),a.find("h1 a").attr("href","/view/welcome-visitors/view/"+f.slug).attr("target",location.host),a.data("site",null),a.removeClass("remote"),q.setUrl(),"fork"!==b.type&&(b.fork=d,e(a.find(".journal"),{type:"fork",site:d,date:b.date}))),k.useLocalStorage()||"local"===f.site?l(a,f,b):m(a,f,b)}},{"./addToJournal":4,"./lineup":15,"./neighborhood":18,"./page":20,"./random":25,"./revision":29,"./state":33,underscore:45}],22:[function(a,b,c){var d,e,f,g,h,i;e=a("./editor"),h=a("./resolve"),g=a("./itemz"),i=function(a){return a.match(/<(i|b|p|a|h\d|hr|br|li|img|div|span|table|blockquote)\b.*?>/i)?"html":"markdown"},f=function(a,b){var c,d,e,f,g;for(e=b.text.split(/\n\n+/),f=[],c=0,d=e.length;c<d;c++)g=e[c],g.match(/\S/)?f.push(a.append("<p>"+h.resolveLinks(g)+"</p>")):f.push(void 0);return f},d=function(a,b){return a.dblclick(function(c){return c.shiftKey?(b.type=i(b.text),g.replaceItem(a,"paragraph",b)):e.textEditor(a,b,{append:!0})})},b.exports={emit:f,bind:d}},{"./editor":8,"./itemz":13,"./resolve":28}],23:[function(a,b,c){var d,e,f,g,h,i=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};b.exports=g={},e=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},d=function(a,b){return b=$.extend(b||{},{dataType:"script",cache:!0,url:a}),$.ajax(b)},h=[],f=g.getScript=function(a,b){return null==b&&(b=function(){}),i.call(h,a)>=0?b():d(a).done(function(){return h.push(a),b()}).fail(function(){return b()})},g.get=g.getPlugin=function(a,b){return window.plugins[a]?b(window.plugins[a]):f("/plugins/"+a+"/"+a+".js",function(){return window.plugins[a]?b(window.plugins[a]):f("/plugins/"+a+".js",function(){return b(window.plugins[a])})})},g.do=g.doPlugin=function(a,b,c){var d;return null==c&&(c=function(){}),d=function(d,f){return a.append('<div class="error">\n  '+e(b.text||"")+"\n  <button>help</button><br>\n</div>"),null!=b.text&&a.find(".error").dblclick(function(c){return wiki.textEditor(a,b)}),a.find("button").on("click",function(){return wiki.dialog(d.toString(),'<p> This "'+b.type+'" plugin won\'t show.</p>\n<li> Is it available on this server?\n<li> Is its markup correct?\n<li> Can it find necessary data?\n<li> Has network access been interrupted?\n<li> Has its code been tested?\n<p> Developers may open debugging tools and retry the plugin.</p>\n<button class="retry">retry</button>\n<p> Learn more\n  <a class="external" target="_blank" rel="nofollow"\n  href="http://plugins.fed.wiki.org/about-plugins.html"\n  title="http://plugins.fed.wiki.org/about-plugins.html">\n    About Plugins\n    <img src="/images/external-link-ltr-icon.png">\n  </a>\n</p>'),$(".retry").on("click",function(){return f.emit.length>2?f.emit(a,b,function(){return f.bind(a,b),c()}):(f.emit(a,b),f.bind(a,b),c())})})},a.data("pageElement",a.parents(".page")),a.data("item",b),g.get(b.type,function(e){var f;try{if(null==e)throw TypeError("Can't find plugin for '"+b.type+"'");return e.emit.length>2?e.emit(a,b,function(){return e.bind(a,b),c()}):(e.emit(a,b),e.bind(a,b),c())}catch(a){return f=a,console.log("plugin error",f),d(f,e),c()}})},g.registerPlugin=function(a,b){return window.plugins[a]=b($)}},{}],24:[function(a,b,c){window.plugins={reference:a("./reference"),factory:a("./factory"),paragraph:a("./paragraph"),image:a("./image"),future:a("./future"),importer:a("./importer")}},{"./factory":9,"./future":10,"./image":11,"./importer":12,"./paragraph":22,"./reference":26}],25:[function(a,b,c){var d,e,f;e=function(){return(256*(1+Math.random())|0).toString(16).substring(1)},f=function(a){return function(){var b,c,d;for(d=[],b=1,c=a;1<=c?b<=c:b>=c;1<=c?b++:b--)d.push(e());return d}().join("")},d=function(){return f(8)},b.exports={randomByte:e,randomBytes:f,itemId:d}},{}],26:[function(a,b,c){var d,e,f,g,h;e=a("./editor"),h=a("./resolve"),g=a("./page"),f=function(a,b){var c,d;return d=b.slug,null!=b.title&&(d||(d=g.asSlug(b.title))),d||(d="welcome-visitors"),c=b.site,h.resolveFrom(c,function(){return a.append("<p>\n  <img class='remote'\n    src='//"+c+"/favicon.png'\n    title='"+c+"'\n    data-site=\""+c+'"\n    data-slug="'+d+'"\n  >\n  '+h.resolveLinks("[["+(b.title||d)+"]]")+"\n  —\n  "+h.resolveLinks(b.text)+"\n</p>")})},d=function(a,b){return a.dblclick(function(){return e.textEditor(a,b)})},b.exports={emit:f,bind:d}},{"./editor":8,"./page":20,"./resolve":28}],27:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L;d=a("underscore"),E=a("./pageHandler"),G=a("./plugin"),L=a("./state"),B=a("./neighborhood"),f=a("./addToJournal"),e=a("./actionSymbols"),A=a("./lineup"),K=a("./resolve"),H=a("./random"),F=a("./page"),C=F.newPage,h=F.asSlug,D=F.pageEmitter,s=function(a){if($(a).length>0)return $(a).data("item")||$(a).data("staticItem")},g=function(a,b,c){var d,e;return d=$.extend({},c),e=A.atKey(a.data("key")),null!=e.getItem(d.id)?(d.alias||(d.alias=d.id),d.id=H.itemId(),b.attr("data-id",d.id)):null!=d.alias&&null==e.getItem(d.alias)&&(d.id=d.alias,delete d.alias,b.attr("data-id",d.id)),d},u=function(a,b){var c,d,e,f,h,i,j,k,l,m,n,o,p,q;if(e=b.item,l=s(e),h=$(this).parents(".page:first"),f=e.data("pageElement"),q=f.data("site"),d=e.parents(".page:first"),k=function(a,b){return a&&b&&a.get(0)===b.get(0)},o=!f||k(f,d),m=!o&&k(h,f),n=!o&&k(h,d),!m||!f.hasClass("ghost")&&f.attr("id")!==d.attr("id")&&!a.shiftKey)return i=o?(p=$(this).children().map(function(a,b){return $(b).attr("data-id")}).get(),{type:"move",order:p}):m?(console.log("drag from",f.find("h1").text()),{type:"remove"}):n?(e.data("pageElement",h),c=e.prev(".item"),j=s(c),l=g(h,e,l),{type:"add",item:l,after:null!=j?j.id:void 0}):void 0,i.id=l.id,E.put(h,i)},y=function(a){var b,c;return c={connectWith:".page .story",placeholder:"item-placeholder",forcePlaceholderSize:!0},b=a.find(".story"),b.sortable(c).on("sortupdate",u)},t=function(a){var b;return b=$(a).parents(".page:first"),A.atKey(b.data("key"))},w=function(a,b){var c,d;return c=t(b.draggable),d=t(a.target),D.emit("show",d.merge(c))},z=function(a){var b;return b=a.find(".journal"),b.draggable({revert:!0,appendTo:".main",scroll:!1,helper:"clone"}),b.droppable({hoverClass:"ui-state-hover",drop:w})},x=function(a){return a.find(".add-factory").on("click",function(b){if(!a.hasClass("ghost"))return b.preventDefault(),j(a)})},j=function(a){var b,c,d,e;return e={type:"factory",id:H.itemId()},c=$("<div />",{class:"item factory"}).data("item",e).attr("data-id",e.id),c.data("pageElement",a),a.find(".story").append(c),G.do(c,e),b=c.prev(".item"),d=s(b),E.put(a,{item:e,id:e.id,type:"add",after:null!=d?d.id:void 0})},v=function(a){var b,c,d,e,f;return a.preventDefault(),A.debugSelfCheck(function(){var a,b,c,e;for(c=$(".page"),e=[],a=0,b=c.length;a<b;a++)d=c[a],e.push($(d).data("key"));return e}()),b=$(a.target).parents(".page:first"),c=A.crumbs(b.data("key"),location.host),f=c[0],e=window.open("//"+c.join("/"),f),e.focus()},p=function(a,b,c){var d,e;return d=c.getRemoteSite(location.host),e=c.getRemoteSiteDetails(location.host),a.append('<h1 title="'+e+'">\n  <a href="'+c.siteLineup()+'" target="'+d+'">\n    <img src="//'+d+'/favicon.png" height="32px" class="favicon">\n  </a> '+K.escape(c.getTitle())+"\n</h1>"),a.find("a").on("click",v)},q=function(a,b,c){if(b.attr("id").match(/_rev/))return b.addClass("ghost"),b.data("rev",c.getRevision()),a.append($('<h2 class="revision">\n  <span>\n    '+c.getTimestamp()+"\n  </span>\n</h2>"))},n=function(a){return a.append('<div class="control-buttons">\n  <a href="#" class="button fork-page" title="fork this page">'+e.fork+'</a>\n  <a href="#" class="button add-factory" title="add paragraph">'+e.add+"</a>\n</div>")},o=function(a,b){var c,d;return c=b.getRemoteSite(location.host),d=b.getSlug(),a.append('<a id="license" href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> .\n<a class="show-page-source" href="/'+d+".json?random="+H.randomBytes(4)+'" title="source">JSON</a> .\n<a href= "//'+c+"/"+d+'.html" target="'+c+'">'+c+' </a> .\n<a href= "#" class=search>search</a>')},m=function(a){var b,c,d;for(d=a||[],c=d.length-1;c>=0;c+=-1)if(b=d[c],b.date&&"fork"!==b.type)return b.date},r=function(a){var b,c,d,e,f,g,i,j,k,l,n,o,p,q,r,s,t;if(l=a.data("data"),l&&(q=a.data("site")||window.location.host,"view"!==q&&"origin"!==q||(q=window.location.host),r=h(l.title),t=m(l.journal))){c={newer:[],same:[],older:[]},n=B.sites;for(p in n)if(f=n[p],p!==q&&null!=f.sitemap)for(o=f.sitemap,i=0,k=o.length;i<k;i++)g=o[i],g.slug===r&&(b=g.date>t?c.newer:g.date<t?c.older:c.same,b.push({remoteSite:p,item:g}));s=[];for(j in c)b=c[j],b.length&&(b.sort(function(a,b){return a.item.date<b.item.date}),d=function(){var a,c,d,f;for(f=[],e=a=0,c=b.length;a<c&&(d=b[e],p=d.remoteSite,g=d.item,!(e>=8));e=++a)f.push('<img class="remote"\nsrc="http://'+p+'/favicon.png"\ndata-slug="'+r+'"\ndata-site="'+p+'"\ntitle="'+p+'">');return f}(),s.push(d.join("&nbsp;")+" "+j));if(s)return a.find(".twins").html("<p>"+s.join(", ")+"</p>")}},J=function(a,b){var c,d,e,g,h,i,j,k;return b.data("data",a.getRawPage()),a.isRemote()&&b.data("site",a.getRemoteSite()),console.log(".page keys ",function(){var a,b,c,d;for(c=$(".page"),d=[],a=0,b=c.length;a<b;a++)j=c[a],d.push($(j).data("key"));return d}()),console.log("lineup keys",A.debugKeys()),K.resolutionContext=a.getContext(),b.empty(),g=$("<div class='paper' />"),b.append(g),k=["twins","header","story","journal","footer"].map(function(a){return $("<div />").addClass(a).appendTo(g)}),i=k[0],d=k[1],h=k[2],e=k[3],c=k[4],p(d,b,a),q(d,b,a),a.seqItems(function(a,b){var c;return c=$('<div class="item '+a.type+'" data-id="'+a.id+'">'),h.append(c),G.do(c,a,b)}),a.seqActions(function(a,b){return a.separator&&f(e,a.separator),f(e,a.action),b()}),r(b),n(e),o(c,a)},k=function(a,b){if(!b.isRemote())return $("img.favicon",a).on("error",function(){return G.get("favicon",function(a){return a.create()})})},I=function(a,b){return a.isLocal()&&b.addClass("local"),a.isRemote()&&b.addClass("remote"),a.isPlugin()&&b.addClass("plugin"),J(a,b),k(b,a),L.setUrl(),y(b),z(b),x(b),b},i=function(a,b){return b.data("key",A.addPage(a)),I(a,b)},l=function(){var a,b,c,e,f,g,h;return a=$(this),e=a.attr("id").split("_rev"),g=e[0],f=e[1],c={slug:g,rev:f,site:a.data("site")},b=function(){var b,c,e,f,h,j,k,l,m,n,o,p,q;q=$('a[href="/'+g+'.html"]:last').text()||g,j=$('a[href="/'+g+'.html"]:last').parents(".page").data("key"),b=null!=(m=A.atKey(j))?m.getCreate():void 0,l=C(),l.setTitle(q),e=[],n=B.sites;for(p in n)f=n[p],null!=f.sitemap&&(o=d.find(f.sitemap,function(a){return a.slug===g}),null!=o&&e.push({type:"reference",site:p,slug:g,title:o.title||g,text:o.synopsis||""}));if(e.length>0)for(l.addItem({type:"future",text:"We could not find this page in the expected context.",title:q,create:b}),l.addItem({type:"paragraph",text:"We did find the page in your current neighborhood."}),h=0,k=e.length;h<k;h++)c=e[h],l.addItem(c);else l.addItem({type:"future",text:"We could not find this page.",title:q,create:b});return i(l,a).addClass("ghost")},h=function(b){var c,d,e,f,g;for(i(b,a),e=b.getNeighbors(location.host),f=[],c=0,d=e.length;c<d;c++)g=e[c],f.push(B.registerNeighbor(g));return f},E.get({whenGotten:h,whenNotGotten:b,pageInformation:c})},b.exports={cycle:l,emitTwins:r,buildPage:i,rebuildPage:I}},{"./actionSymbols":2,"./addToJournal":4,"./lineup":15,"./neighborhood":18,"./page":20,"./pageHandler":21,"./plugin":23,"./random":25,"./resolve":28,"./state":33,underscore:45}],28:[function(a,b,c){var d,e,f;d=a("./page").asSlug,b.exports=f={},f.resolutionContext=[],f.escape=e=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},f.resolveFrom=function(a,b){f.resolutionContext.push(a);try{return b()}finally{f.resolutionContext.pop()}},f.resolveLinks=function(a,b){var c,g,h,i,j;return null==b&&(b=e),i=[],h=function(a){var b;return b=i.length,i.push(a),"〖"+b+"〗"},j=function(a,b){return i[+b]},g=function(a,b){var c;return c=d(b),h('<a class="internal" href="/'+c+'.html" data-page-name="'+c+'" title="'+f.resolutionContext.join(" => ")+'">'+e(b)+"</a>")},c=function(a,b,c,d){return h('<a class="external" target="_blank" href="'+b+'" title="'+b+'" rel="nofollow">'+e(d)+' <img src="/images/external-link-ltr-icon.png"></a>')},a=a.replace(/〖(\d+)〗/g,"〖 $1 〗").replace(/\[\[([^\]]+)\]\]/gi,g).replace(/\[((http|https|ftp):.*?) (.*?)\]/gi,c),b(a).replace(/〖(\d+)〗/g,j)}},{"./page":20}],29:[function(a,b,c){var d,e;d=function(a,b){var c,d,e,f,g,h;switch(g=function(){var b,c,d,e,f;for(e=a.story||[],f=[],b=0,d=e.length;b<d;b++)c=e[b],f.push(null!=c?c.id:void 0);return f},c=function(b,c){var d;return d=g().indexOf(b)+1,a.story.splice(d,0,c)},h=function(){var c;if((c=g().indexOf(b.id))!==-1)return a.story.splice(c,1)},a.story||(a.story=[]),b.type){case"create":null!=b.item&&(null!=b.item.title&&(a.title=b.item.title),null!=b.item.story&&(a.story=b.item.story.slice()));break;case"add":c(b.after,b.item);break;case"edit":(e=g().indexOf(b.id))!==-1?a.story.splice(e,1,b.item):a.story.push(b.item);break;case"move":e=b.order.indexOf(b.id),d=b.order[e-1],f=a.story[g().indexOf(b.id)],h(),c(d,f);break;case"remove":h()}return a.journal||(a.journal=[]),a.journal.push(b)},e=function(a,b){var c,e,f,g,h;for(a=+a,g=b.journal.slice(0,+a+1||9e9),h={title:b.title,story:[]},e=0,f=g.length;e<f;e++)c=g[e],d(h,c||{});return h},b.exports={create:e,apply:d}},{}],30:[function(a,b,c){var d,e,f,g;f=a("./link"),d=a("./active"),g=a("./page").newPage,e=function(a){var b,c;return b=a.neighborhood,c=function(a){var c,d,e,h,i,j,k;for(j=b.search(a),k=j.tally,i=g(),i.setTitle("Search for '"+a+"'"),i.addParagraph("String '"+a+"' found on "+(k.finds||"none")+" of "+(k.pages||"no")+" pages from "+(k.sites||"no")+" sites.\nText matched on "+(k.title||"no")+" titles, "+(k.text||"no")+" paragraphs, and "+(k.slug||"no")+" slugs.\nElapsed time "+k.msec+" milliseconds."),e=j.finds,c=0,d=e.length;c<d;c++)h=e[c],i.addItem({type:"reference",site:h.site,slug:h.page.slug,title:h.page.title,text:h.page.synopsis||""});return f.showResult(i)},{performSearch:c}},b.exports=e},{"./active":3,"./link":17,"./page":20}],31:[function(a,b,c){var d,e,f,g;e=a("./search"),g=null,f=function(a){return g=e({neighborhood:a})},d=function(){return $("input.search").on("keypress",function(a){var b;if(13===a.keyCode)return b=$(this).val(),g.performSearch(b),$(this).val("")})},b.exports={inject:f,bind:d}},{"./search":30}],32:[function(a,b,c){var d,e;b.exports=e={},d=a("./plugin"),b.exports=function(a){return d.getScript("/security/security.js",function(){return window.plugins.security.setup(a)})}},{"./plugin":23}],33:[function(a,b,c){var d,e,f,g,h=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};d=a("./active"),e=a("./lineup"),f=null,b.exports=g={},g.inject=function(a){return f=a},g.pagesInDom=function(){return $.makeArray($(".page").map(function(a,b){return b.id}))},g.urlPages=function(){var a;return function(){var b,c,d,e;for(d=$(location).attr("pathname").split("/"),e=[],b=0,c=d.length;b<c;b+=2)a=d[b],e.push(a);return e}().slice(1)},g.locsInDom=function(){return $.makeArray($(".page").map(function(a,b){return $(b).data("site")||"view"}))},g.urlLocs=function(){var a,b,c,d,e;for(d=$(location).attr("pathname").split("/").slice(1),e=[],b=0,c=d.length;b<c;b+=2)a=d[b],e.push(a);return e},g.setUrl=function(){var a,b,c,d,f;if(document.title=e.bestTitle(),history&&history.pushState&&(b=g.locsInDom(),d=g.pagesInDom(),f=function(){var e,f,g;for(g=[],a=e=0,f=d.length;e<f;a=++e)c=d[a],g.push("/"+((null!=b?b[a]:void 0)||"view")+"/"+c);return g}().join(""),f!==$(location).attr("pathname")))return history.pushState(null,null,f)},g.show=function(a){var b,c,h,i,j,k,l,m,n,o,p,q,r;if(r=g.pagesInDom(),o=g.urlPages(),q=g.locsInDom(),n=g.urlLocs(),location.pathname&&"/"!==location.pathname){for(l=!0,c=h=0,j=r.length;h<j;c=++h)m=r[c],l&&(l=m===o[c])||(p=$(".page:last"),e.removeKey(p.data("key")),p.remove());for(l=!0,c=i=0,k=o.length;i<k;c=++i)m=o[c],l&&(l=m===r[c])||(console.log("push",c,m),f.showPage(m,n[c]));return console.log("a .page keys ",function(){var a,c,d,e;for(d=$(".page"),e=[],c=0,a=d.length;c<a;c++)b=d[c],e.push($(b).data("key"));return e}()),console.log("a lineup keys",e.debugKeys()),d.set($(".page").last()),document.title=e.bestTitle()}},g.first=function(){var a,b,c,d,e,i,j,k;for(g.setUrl(),b=g.urlPages(),a=g.urlLocs(),i=g.pagesInDom(),j=[],c=d=0,e=b.length;d<e;c=++d)k=b[c],h.call(i,k)<0&&(""!==k?j.push(f.createPage(k,a[c])):j.push(void 0));return j}},{"./active":3,"./lineup":15}],34:[function(a,b,c){b.exports=function(a){var b,c,d;return d=a.synopsis,null!=a&&null!=a.story?(b=a.story[0],c=a.story[1],b&&"paragraph"===b.type&&(d||(d=b.text)),c&&"paragraph"===c.type&&(d||(d=c.text)),b&&null!=b.text&&(d||(d=b.text)),c&&null!=c.text&&(d||(d=c.text)),d||(d=null!=a.story&&"A page with "+a.story.length+" items.")):d="A page with no story.",d}},{}],35:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;n=!1,i=null,d=null,f=function(){return $(document).keydown(function(a){if(16===a.keyCode)return l(a)}).keyup(function(a){if(16===a.keyCode)return m(a)}),$(".main").delegate(".item","mouseenter",h).delegate(".item","mouseleave",k).delegate(".action","mouseenter",g).delegate(".action","mouseleave",j).delegate(".page","align-item",e)},l=function(a){var b;if(n=a.shiftKey,n&&(b=i||d))return $("[data-id="+b+"]").addClass("target")},m=function(a){if(n=a.shiftKey,!n)return $(".item, .action").removeClass("target")},h=function(a){var b,c,d,e;if(i=(b=$(this)).attr("data-id"),n)return $("[data-id="+i+"]").addClass("target"),d=(c=$(this).parents(".page:first")).data("key"),e=b.offset().top,$(".page").trigger("align-item",{key:d,id:i,place:e})},k=function(a){return n&&$(".item, .action").removeClass("target"),i=null},g=function(a){var b;if(d=$(this).data("id"),n)return $("[data-id="+d+"]").addClass("target"),b=$(this).parents(".page:first").data("key"),$(".page").trigger("align-item",{key:b,id:d})},j=function(a){return n&&$("[data-id="+d+"]").removeClass("target"),d=null},e=function(a,b){var c,d,e,f;if(d=$(this),d.data("key")!==b.key&&(c=d.find(".item[data-id="+b.id+"]"),c.length))return f=b.place||d.height()/2,e=c.offset().top+d.scrollTop()-f,d.stop().animate({scrollTop:e},"slow")},b.exports={bind:f}},{}],36:[function(a,b,c){var d;b.exports=d={},d.formatTime=function(a){var b,c,d,e,f;return c=new Date(a>1e10?a:1e3*a),f=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][c.getMonth()],d=c.getHours(),b=d<12?"AM":"PM",d=0===d?12:d>12?d-12:d,e=(c.getMinutes()<10?"0":"")+c.getMinutes(),d+":"+e+" "+b+"<br>"+c.getDate()+" "+f+" "+c.getFullYear()},d.formatDate=function(a){var b,c,d,e,f,g,h,i,j;return c=new Date(a),i=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][c.getDay()],g=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][c.getMonth()],d=c.getDate(),j=c.getFullYear(),e=c.getHours(),b=e<12?"AM":"PM",e=0===e?12:e>12?e-12:e,f=(c.getMinutes()<10?"0":"")+c.getMinutes(),h=(c.getSeconds()<10?"0":"")+c.getSeconds(),i+" "+g+" "+d+", "+j+"<br>"+e+":"+f+":"+h+" "+b},d.formatElapsedTime=function(a){var b,c,d,e,f,g,h,i;return f=(new Date).getTime()-a,(g=f/1e3)<2?Math.floor(f)+" milliseconds ago":(d=g/60)<2?Math.floor(g)+" seconds ago":(c=d/60)<2?Math.floor(d)+" minutes ago":(b=c/24)<2?Math.floor(c)+" hours ago":(h=b/7)<2?Math.floor(b)+" days ago":(e=b/31)<2?Math.floor(h)+" weeks ago":(i=b/365)<2?Math.floor(e)+" months ago":Math.floor(i)+" years ago"}},{}],37:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m=[].slice;l={},l.asSlug=a("./page").asSlug,l.newPage=a("./page").newPage,f=a("./itemz"),l.removeItem=f.removeItem,l.createItem=f.createItem,l.getItem=f.getItem,d=a("./dialog"),l.dialog=d.open,g=a("./link"),l.createPage=g.createPage,l.doInternalLink=g.doInternalLink,l.showResult=g.showResult,j=a("./plugin"),l.getScript=j.getScript,l.getPlugin=j.getPlugin,l.doPlugin=j.doPlugin,l.registerPlugin=j.registerPlugin,l.getData=function(a){var b,c;return a?(b=$(".item").index(a),c=$(".item:lt("+b+")").filter(".chart,.data,.calculator").last(),null!=c?c.data("item").data:{}):(c=$(".chart,.data,.calculator").last(),null!=c?c.data("item").data:{})},l.getDataNodes=function(a){var b,c;return a?(b=$(".item").index(a),c=$(".item:lt("+b+")").filter(".chart,.data,.calculator").toArray().reverse(),$(c)):(c=$(".chart,.data,.calculator").toArray().reverse(),$(c))},l.log=function(){var a;if(a=1<=arguments.length?m.call(arguments,0):[],null!=("undefined"!=typeof console&&null!==console?console.log:void 0))return console.log.apply(console,a)},h=a("./neighborhood"),l.neighborhood=h.sites,l.neighborhoodObject=h,i=a("./pageHandler"),l.pageHandler=i,l.useLocalStorage=i.useLocalStorage,k=a("./resolve"),l.resolveFrom=k.resolveFrom,l.resolveLinks=k.resolveLinks,l.resolutionContext=k.resolutionContext,e=a("./editor"),l.textEditor=e.textEditor,l.util=a("./util"),l.security=a("./security"),l.createSynopsis=a("./synopsis"),b.exports=l},{"./dialog":6,"./editor":8,"./itemz":13,"./link":17,"./neighborhood":18,"./page":20,"./pageHandler":21,"./plugin":23,"./resolve":28,"./security":32,"./synopsis":34,"./util":36}],38:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:f=Array.prototype.slice.call(arguments,1),c.apply(this,f)}else if(g(c))for(f=Array.prototype.slice.call(arguments,1),j=c.slice(),d=j.length,i=0;i<d;i++)j[i].apply(this,f);return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned&&(c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(d<0)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(e(b))return 1;if(b)return b.length}return 0},d.listenerCount=function(a,b){return a.listenerCount(b)}},{}],39:[function(a,b,c){(function(a){!function(d){function e(a){throw new RangeError(H[a])}function f(a,b){for(var c=a.length,d=[];c--;)d[c]=b(a[c]);return d}function g(a,b){var c=a.split("@"),d="";c.length>1&&(d=c[0]+"@",a=c[1]),a=a.replace(G,".");var e=a.split("."),g=f(e,b).join(".");return d+g}function h(a){for(var b,c,d=[],e=0,f=a.length;e<f;)b=a.charCodeAt(e++),b>=55296&&b<=56319&&e<f?(c=a.charCodeAt(e++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b),e--)):d.push(b);return d}function i(a){return f(a,function(a){var b="";return a>65535&&(a-=65536,b+=K(a>>>10&1023|55296),a=56320|1023&a),b+=K(a)}).join("")}function j(a){return a-48<10?a-22:a-65<26?a-65:a-97<26?a-97:w}function k(a,b){return a+22+75*(a<26)-((0!=b)<<5)}function l(a,b,c){var d=0;for(a=c?J(a/A):a>>1,a+=J(a/b);a>I*y>>1;d+=w)a=J(a/I);return J(d+(I+1)*a/(a+z))}function m(a){var b,c,d,f,g,h,k,m,n,o,p=[],q=a.length,r=0,s=C,t=B;for(c=a.lastIndexOf(D),c<0&&(c=0),d=0;d<c;++d)a.charCodeAt(d)>=128&&e("not-basic"),p.push(a.charCodeAt(d));for(f=c>0?c+1:0;f<q;){for(g=r,h=1,k=w;f>=q&&e("invalid-input"),m=j(a.charCodeAt(f++)),(m>=w||m>J((v-r)/h))&&e("overflow"),r+=m*h,n=k<=t?x:k>=t+y?y:k-t,!(m<n);k+=w)o=w-n,h>J(v/o)&&e("overflow"),h*=o;b=p.length+1,t=l(r-g,b,0==g),J(r/b)>v-s&&e("overflow"),s+=J(r/b),r%=b,p.splice(r++,0,s)}return i(p)}function n(a){var b,c,d,f,g,i,j,m,n,o,p,q,r,s,t,u=[];for(a=h(a),q=a.length,b=C,c=0,g=B,i=0;i<q;++i)p=a[i],p<128&&u.push(K(p));for(d=f=u.length,f&&u.push(D);d<q;){for(j=v,i=0;i<q;++i)p=a[i],p>=b&&p<j&&(j=p);for(r=d+1,j-b>J((v-c)/r)&&e("overflow"),c+=(j-b)*r,b=j,i=0;i<q;++i)if(p=a[i],p<b&&++c>v&&e("overflow"),p==b){for(m=c,n=w;o=n<=g?x:n>=g+y?y:n-g,!(m<o);n+=w)t=m-o,s=w-o,u.push(K(k(o+t%s,0))),m=J(t/s);u.push(K(k(m,0))),g=l(c,r,d==f),c=0,++d}++c,++b}return u.join("")}function o(a){return g(a,function(a){return E.test(a)?m(a.slice(4).toLowerCase()):a})}function p(a){return g(a,function(a){return F.test(a)?"xn--"+n(a):a})}var q="object"==typeof c&&c&&!c.nodeType&&c,r="object"==typeof b&&b&&!b.nodeType&&b,s="object"==typeof a&&a;s.global!==s&&s.window!==s&&s.self!==s||(d=s);var t,u,v=2147483647,w=36,x=1,y=26,z=38,A=700,B=72,C=128,D="-",E=/^xn--/,F=/[^\x20-\x7E]/,G=/[\x2E\u3002\uFF0E\uFF61]/g,H={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},I=w-x,J=Math.floor,K=String.fromCharCode;if(t={version:"1.4.1",ucs2:{decode:h,encode:i},decode:m,encode:n,toASCII:p,toUnicode:o},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return t});else if(q&&r)if(b.exports==q)r.exports=t;else for(u in t)t.hasOwnProperty(u)&&(q[u]=t[u]);else d.punycode=t}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],40:[function(a,b,c){"use strict";function d(a,b){return Object.prototype.hasOwnProperty.call(a,b)}b.exports=function(a,b,c,f){b=b||"&",c=c||"=";var g={};if("string"!=typeof a||0===a.length)return g;var h=/\+/g;a=a.split(b);var i=1e3;f&&"number"==typeof f.maxKeys&&(i=f.maxKeys);var j=a.length;i>0&&j>i&&(j=i);for(var k=0;k<j;++k){var l,m,n,o,p=a[k].replace(h,"%20"),q=p.indexOf(c);q>=0?(l=p.substr(0,q),m=p.substr(q+1)):(l=p,m=""),n=decodeURIComponent(l),o=decodeURIComponent(m),d(g,n)?e(g[n])?g[n].push(o):g[n]=[g[n],o]:g[n]=o}return g};var e=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)}},{}],41:[function(a,b,c){"use strict";function d(a,b){if(a.map)return a.map(b);for(var c=[],d=0;d<a.length;d++)c.push(b(a[d],d));return c}var e=function(a){switch(typeof a){case"string":return a;case"boolean":return a?"true":"false";case"number":return isFinite(a)?a:"";default:return""}};b.exports=function(a,b,c,h){return b=b||"&",c=c||"=",null===a&&(a=void 0),"object"==typeof a?d(g(a),function(g){var h=encodeURIComponent(e(g))+c;return f(a[g])?d(a[g],function(a){return h+encodeURIComponent(e(a))}).join(b):h+encodeURIComponent(e(a[g]))}).join(b):h?encodeURIComponent(e(h))+c+encodeURIComponent(e(a)):""};var f=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},g=Object.keys||function(a){var b=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b}},{}],42:[function(a,b,c){"use strict";c.decode=c.parse=a("./decode"),c.encode=c.stringify=a("./encode")},{"./decode":40,"./encode":41}],43:[function(a,b,c){"use strict";function d(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function e(a,b,c){if(a&&j.isObject(a)&&a instanceof d)return a;var e=new d;return e.parse(a,b,c),e}function f(a){return j.isString(a)&&(a=e(a)),a instanceof d?a.format():d.prototype.format.call(a)}function g(a,b){return e(a,!1,!0).resolve(b)}function h(a,b){return a?e(a,!1,!0).resolveObject(b):b}var i=a("punycode"),j=a("./util");c.parse=e,c.resolve=g,c.resolveObject=h,c.format=f,c.Url=d;var k=/^([a-z0-9.+-]+:)/i,l=/:[0-9]*$/,m=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,n=["<",">",'"',"`"," ","\r","\n","\t"],o=["{","}","|","\\","^","`"].concat(n),p=["'"].concat(o),q=["%","/","?",";","#"].concat(p),r=["/","?","#"],s=255,t=/^[+a-z0-9A-Z_-]{0,63}$/,u=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,v={javascript:!0,"javascript:":!0},w={javascript:!0,"javascript:":!0
},x={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=a("querystring");d.prototype.parse=function(a,b,c){if(!j.isString(a))throw new TypeError("Parameter 'url' must be a string, not "+typeof a);var d=a.indexOf("?"),e=d!==-1&&d<a.indexOf("#")?"?":"#",f=a.split(e),g=/\\/g;f[0]=f[0].replace(g,"/"),a=f.join(e);var h=a;if(h=h.trim(),!c&&1===a.split("#").length){var l=m.exec(h);if(l)return this.path=h,this.href=h,this.pathname=l[1],l[2]?(this.search=l[2],b?this.query=y.parse(this.search.substr(1)):this.query=this.search.substr(1)):b&&(this.search="",this.query={}),this}var n=k.exec(h);if(n){n=n[0];var o=n.toLowerCase();this.protocol=o,h=h.substr(n.length)}if(c||n||h.match(/^\/\/[^@\/]+@[^@\/]+/)){var z="//"===h.substr(0,2);!z||n&&w[n]||(h=h.substr(2),this.slashes=!0)}if(!w[n]&&(z||n&&!x[n])){for(var A=-1,B=0;B<r.length;B++){var C=h.indexOf(r[B]);C!==-1&&(A===-1||C<A)&&(A=C)}var D,E;E=A===-1?h.lastIndexOf("@"):h.lastIndexOf("@",A),E!==-1&&(D=h.slice(0,E),h=h.slice(E+1),this.auth=decodeURIComponent(D)),A=-1;for(var B=0;B<q.length;B++){var C=h.indexOf(q[B]);C!==-1&&(A===-1||C<A)&&(A=C)}A===-1&&(A=h.length),this.host=h.slice(0,A),h=h.slice(A),this.parseHost(),this.hostname=this.hostname||"";var F="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!F)for(var G=this.hostname.split(/\./),B=0,H=G.length;B<H;B++){var I=G[B];if(I&&!I.match(t)){for(var J="",K=0,L=I.length;K<L;K++)J+=I.charCodeAt(K)>127?"x":I[K];if(!J.match(t)){var M=G.slice(0,B),N=G.slice(B+1),O=I.match(u);O&&(M.push(O[1]),N.unshift(O[2])),N.length&&(h="/"+N.join(".")+h),this.hostname=M.join(".");break}}}this.hostname.length>s?this.hostname="":this.hostname=this.hostname.toLowerCase(),F||(this.hostname=i.toASCII(this.hostname));var P=this.port?":"+this.port:"",Q=this.hostname||"";this.host=Q+P,this.href+=this.host,F&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==h[0]&&(h="/"+h))}if(!v[o])for(var B=0,H=p.length;B<H;B++){var R=p[B];if(h.indexOf(R)!==-1){var S=encodeURIComponent(R);S===R&&(S=escape(R)),h=h.split(R).join(S)}}var T=h.indexOf("#");T!==-1&&(this.hash=h.substr(T),h=h.slice(0,T));var U=h.indexOf("?");if(U!==-1?(this.search=h.substr(U),this.query=h.substr(U+1),b&&(this.query=y.parse(this.query)),h=h.slice(0,U)):b&&(this.search="",this.query={}),h&&(this.pathname=h),x[o]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var P=this.pathname||"",V=this.search||"";this.path=P+V}return this.href=this.format(),this},d.prototype.format=function(){var a=this.auth||"";a&&(a=encodeURIComponent(a),a=a.replace(/%3A/i,":"),a+="@");var b=this.protocol||"",c=this.pathname||"",d=this.hash||"",e=!1,f="";this.host?e=a+this.host:this.hostname&&(e=a+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(e+=":"+this.port)),this.query&&j.isObject(this.query)&&Object.keys(this.query).length&&(f=y.stringify(this.query));var g=this.search||f&&"?"+f||"";return b&&":"!==b.substr(-1)&&(b+=":"),this.slashes||(!b||x[b])&&e!==!1?(e="//"+(e||""),c&&"/"!==c.charAt(0)&&(c="/"+c)):e||(e=""),d&&"#"!==d.charAt(0)&&(d="#"+d),g&&"?"!==g.charAt(0)&&(g="?"+g),c=c.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),g=g.replace("#","%23"),b+e+c+g+d},d.prototype.resolve=function(a){return this.resolveObject(e(a,!1,!0)).format()},d.prototype.resolveObject=function(a){if(j.isString(a)){var b=new d;b.parse(a,!1,!0),a=b}for(var c=new d,e=Object.keys(this),f=0;f<e.length;f++){var g=e[f];c[g]=this[g]}if(c.hash=a.hash,""===a.href)return c.href=c.format(),c;if(a.slashes&&!a.protocol){for(var h=Object.keys(a),i=0;i<h.length;i++){var k=h[i];"protocol"!==k&&(c[k]=a[k])}return x[c.protocol]&&c.hostname&&!c.pathname&&(c.path=c.pathname="/"),c.href=c.format(),c}if(a.protocol&&a.protocol!==c.protocol){if(!x[a.protocol]){for(var l=Object.keys(a),m=0;m<l.length;m++){var n=l[m];c[n]=a[n]}return c.href=c.format(),c}if(c.protocol=a.protocol,a.host||w[a.protocol])c.pathname=a.pathname;else{for(var o=(a.pathname||"").split("/");o.length&&!(a.host=o.shift()););a.host||(a.host=""),a.hostname||(a.hostname=""),""!==o[0]&&o.unshift(""),o.length<2&&o.unshift(""),c.pathname=o.join("/")}if(c.search=a.search,c.query=a.query,c.host=a.host||"",c.auth=a.auth,c.hostname=a.hostname||a.host,c.port=a.port,c.pathname||c.search){var p=c.pathname||"",q=c.search||"";c.path=p+q}return c.slashes=c.slashes||a.slashes,c.href=c.format(),c}var r=c.pathname&&"/"===c.pathname.charAt(0),s=a.host||a.pathname&&"/"===a.pathname.charAt(0),t=s||r||c.host&&a.pathname,u=t,v=c.pathname&&c.pathname.split("/")||[],o=a.pathname&&a.pathname.split("/")||[],y=c.protocol&&!x[c.protocol];if(y&&(c.hostname="",c.port=null,c.host&&(""===v[0]?v[0]=c.host:v.unshift(c.host)),c.host="",a.protocol&&(a.hostname=null,a.port=null,a.host&&(""===o[0]?o[0]=a.host:o.unshift(a.host)),a.host=null),t=t&&(""===o[0]||""===v[0])),s)c.host=a.host||""===a.host?a.host:c.host,c.hostname=a.hostname||""===a.hostname?a.hostname:c.hostname,c.search=a.search,c.query=a.query,v=o;else if(o.length)v||(v=[]),v.pop(),v=v.concat(o),c.search=a.search,c.query=a.query;else if(!j.isNullOrUndefined(a.search)){if(y){c.hostname=c.host=v.shift();var z=!!(c.host&&c.host.indexOf("@")>0)&&c.host.split("@");z&&(c.auth=z.shift(),c.host=c.hostname=z.shift())}return c.search=a.search,c.query=a.query,j.isNull(c.pathname)&&j.isNull(c.search)||(c.path=(c.pathname?c.pathname:"")+(c.search?c.search:"")),c.href=c.format(),c}if(!v.length)return c.pathname=null,c.search?c.path="/"+c.search:c.path=null,c.href=c.format(),c;for(var A=v.slice(-1)[0],B=(c.host||a.host||v.length>1)&&("."===A||".."===A)||""===A,C=0,D=v.length;D>=0;D--)A=v[D],"."===A?v.splice(D,1):".."===A?(v.splice(D,1),C++):C&&(v.splice(D,1),C--);if(!t&&!u)for(;C--;C)v.unshift("..");!t||""===v[0]||v[0]&&"/"===v[0].charAt(0)||v.unshift(""),B&&"/"!==v.join("/").substr(-1)&&v.push("");var E=""===v[0]||v[0]&&"/"===v[0].charAt(0);if(y){c.hostname=c.host=E?"":v.length?v.shift():"";var z=!!(c.host&&c.host.indexOf("@")>0)&&c.host.split("@");z&&(c.auth=z.shift(),c.host=c.hostname=z.shift())}return t=t||c.host&&v.length,t&&!E&&v.unshift(""),v.length?c.pathname=v.join("/"):(c.pathname=null,c.path=null),j.isNull(c.pathname)&&j.isNull(c.search)||(c.path=(c.pathname?c.pathname:"")+(c.search?c.search:"")),c.auth=a.auth||c.auth,c.slashes=c.slashes||a.slashes,c.href=c.format(),c},d.prototype.parseHost=function(){var a=this.host,b=l.exec(a);b&&(b=b[0],":"!==b&&(this.port=b.substr(1)),a=a.substr(0,a.length-b.length)),a&&(this.hostname=a)}},{"./util":44,punycode:39,querystring:42}],44:[function(a,b,c){"use strict";b.exports={isString:function(a){return"string"==typeof a},isObject:function(a){return"object"==typeof a&&null!==a},isNull:function(a){return null===a},isNullOrUndefined:function(a){return null==a}}},{}],45:[function(a,b,c){(function(){function a(a){function b(b,c,d,e,f,g){for(;f>=0&&f<g;f+=a){var h=e?e[f]:f;d=c(d,b[h],h,b)}return d}return function(c,d,e,f){d=v(d,f,4);var g=!C(c)&&u.keys(c),h=(g||c).length,i=a>0?0:h-1;return arguments.length<3&&(e=c[g?g[i]:i],i+=a),b(c,d,e,g,i,h)}}function d(a){return function(b,c,d){c=w(c,d);for(var e=B(b),f=a>0?0:e-1;f>=0&&f<e;f+=a)if(c(b[f],f,b))return f;return-1}}function e(a,b,c){return function(d,e,f){var g=0,h=B(d);if("number"==typeof f)a>0?g=f>=0?f:Math.max(f+h,g):h=f>=0?Math.min(f+1,h):f+h+1;else if(c&&f&&h)return f=c(d,e),d[f]===e?f:-1;if(e!==e)return f=b(m.call(d,g,h),u.isNaN),f>=0?f+g:-1;for(f=a>0?g:h-1;f>=0&&f<h;f+=a)if(d[f]===e)return f;return-1}}function f(a,b){var c=H.length,d=a.constructor,e=u.isFunction(d)&&d.prototype||j,f="constructor";for(u.has(a,f)&&!u.contains(b,f)&&b.push(f);c--;)f=H[c],f in a&&a[f]!==e[f]&&!u.contains(b,f)&&b.push(f)}var g=this,h=g._,i=Array.prototype,j=Object.prototype,k=Function.prototype,l=i.push,m=i.slice,n=j.toString,o=j.hasOwnProperty,p=Array.isArray,q=Object.keys,r=k.bind,s=Object.create,t=function(){},u=function(a){return a instanceof u?a:this instanceof u?void(this._wrapped=a):new u(a)};"undefined"!=typeof c?("undefined"!=typeof b&&b.exports&&(c=b.exports=u),c._=u):g._=u,u.VERSION="1.8.3";var v=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}},w=function(a,b,c){return null==a?u.identity:u.isFunction(a)?v(a,b,c):u.isObject(a)?u.matcher(a):u.property(a)};u.iteratee=function(a,b){return w(a,b,1/0)};var x=function(a,b){return function(c){var d=arguments.length;if(d<2||null==c)return c;for(var e=1;e<d;e++)for(var f=arguments[e],g=a(f),h=g.length,i=0;i<h;i++){var j=g[i];b&&void 0!==c[j]||(c[j]=f[j])}return c}},y=function(a){if(!u.isObject(a))return{};if(s)return s(a);t.prototype=a;var b=new t;return t.prototype=null,b},z=function(a){return function(b){return null==b?void 0:b[a]}},A=Math.pow(2,53)-1,B=z("length"),C=function(a){var b=B(a);return"number"==typeof b&&b>=0&&b<=A};u.each=u.forEach=function(a,b,c){b=v(b,c);var d,e;if(C(a))for(d=0,e=a.length;d<e;d++)b(a[d],d,a);else{var f=u.keys(a);for(d=0,e=f.length;d<e;d++)b(a[f[d]],f[d],a)}return a},u.map=u.collect=function(a,b,c){b=w(b,c);for(var d=!C(a)&&u.keys(a),e=(d||a).length,f=Array(e),g=0;g<e;g++){var h=d?d[g]:g;f[g]=b(a[h],h,a)}return f},u.reduce=u.foldl=u.inject=a(1),u.reduceRight=u.foldr=a(-1),u.find=u.detect=function(a,b,c){var d;if(d=C(a)?u.findIndex(a,b,c):u.findKey(a,b,c),void 0!==d&&d!==-1)return a[d]},u.filter=u.select=function(a,b,c){var d=[];return b=w(b,c),u.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d},u.reject=function(a,b,c){return u.filter(a,u.negate(w(b)),c)},u.every=u.all=function(a,b,c){b=w(b,c);for(var d=!C(a)&&u.keys(a),e=(d||a).length,f=0;f<e;f++){var g=d?d[f]:f;if(!b(a[g],g,a))return!1}return!0},u.some=u.any=function(a,b,c){b=w(b,c);for(var d=!C(a)&&u.keys(a),e=(d||a).length,f=0;f<e;f++){var g=d?d[f]:f;if(b(a[g],g,a))return!0}return!1},u.contains=u.includes=u.include=function(a,b,c,d){return C(a)||(a=u.values(a)),("number"!=typeof c||d)&&(c=0),u.indexOf(a,b,c)>=0},u.invoke=function(a,b){var c=m.call(arguments,2),d=u.isFunction(b);return u.map(a,function(a){var e=d?b:a[b];return null==e?e:e.apply(a,c)})},u.pluck=function(a,b){return u.map(a,u.property(b))},u.where=function(a,b){return u.filter(a,u.matcher(b))},u.findWhere=function(a,b){return u.find(a,u.matcher(b))},u.max=function(a,b,c){var d,e,f=-(1/0),g=-(1/0);if(null==b&&null!=a){a=C(a)?a:u.values(a);for(var h=0,i=a.length;h<i;h++)d=a[h],d>f&&(f=d)}else b=w(b,c),u.each(a,function(a,c,d){e=b(a,c,d),(e>g||e===-(1/0)&&f===-(1/0))&&(f=a,g=e)});return f},u.min=function(a,b,c){var d,e,f=1/0,g=1/0;if(null==b&&null!=a){a=C(a)?a:u.values(a);for(var h=0,i=a.length;h<i;h++)d=a[h],d<f&&(f=d)}else b=w(b,c),u.each(a,function(a,c,d){e=b(a,c,d),(e<g||e===1/0&&f===1/0)&&(f=a,g=e)});return f},u.shuffle=function(a){for(var b,c=C(a)?a:u.values(a),d=c.length,e=Array(d),f=0;f<d;f++)b=u.random(0,f),b!==f&&(e[f]=e[b]),e[b]=c[f];return e},u.sample=function(a,b,c){return null==b||c?(C(a)||(a=u.values(a)),a[u.random(a.length-1)]):u.shuffle(a).slice(0,Math.max(0,b))},u.sortBy=function(a,b,c){return b=w(b,c),u.pluck(u.map(a,function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(c<d||void 0===d)return-1}return a.index-b.index}),"value")};var D=function(a){return function(b,c,d){var e={};return c=w(c,d),u.each(b,function(d,f){var g=c(d,f,b);a(e,d,g)}),e}};u.groupBy=D(function(a,b,c){u.has(a,c)?a[c].push(b):a[c]=[b]}),u.indexBy=D(function(a,b,c){a[c]=b}),u.countBy=D(function(a,b,c){u.has(a,c)?a[c]++:a[c]=1}),u.toArray=function(a){return a?u.isArray(a)?m.call(a):C(a)?u.map(a,u.identity):u.values(a):[]},u.size=function(a){return null==a?0:C(a)?a.length:u.keys(a).length},u.partition=function(a,b,c){b=w(b,c);var d=[],e=[];return u.each(a,function(a,c,f){(b(a,c,f)?d:e).push(a)}),[d,e]},u.first=u.head=u.take=function(a,b,c){if(null!=a)return null==b||c?a[0]:u.initial(a,a.length-b)},u.initial=function(a,b,c){return m.call(a,0,Math.max(0,a.length-(null==b||c?1:b)))},u.last=function(a,b,c){if(null!=a)return null==b||c?a[a.length-1]:u.rest(a,Math.max(0,a.length-b))},u.rest=u.tail=u.drop=function(a,b,c){return m.call(a,null==b||c?1:b)},u.compact=function(a){return u.filter(a,u.identity)};var E=function(a,b,c,d){for(var e=[],f=0,g=d||0,h=B(a);g<h;g++){var i=a[g];if(C(i)&&(u.isArray(i)||u.isArguments(i))){b||(i=E(i,b,c));var j=0,k=i.length;for(e.length+=k;j<k;)e[f++]=i[j++]}else c||(e[f++]=i)}return e};u.flatten=function(a,b){return E(a,b,!1)},u.without=function(a){return u.difference(a,m.call(arguments,1))},u.uniq=u.unique=function(a,b,c,d){u.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=w(c,d));for(var e=[],f=[],g=0,h=B(a);g<h;g++){var i=a[g],j=c?c(i,g,a):i;b?(g&&f===j||e.push(i),f=j):c?u.contains(f,j)||(f.push(j),e.push(i)):u.contains(e,i)||e.push(i)}return e},u.union=function(){return u.uniq(E(arguments,!0,!0))},u.intersection=function(a){for(var b=[],c=arguments.length,d=0,e=B(a);d<e;d++){var f=a[d];if(!u.contains(b,f)){for(var g=1;g<c&&u.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},u.difference=function(a){var b=E(arguments,!0,!0,1);return u.filter(a,function(a){return!u.contains(b,a)})},u.zip=function(){return u.unzip(arguments)},u.unzip=function(a){for(var b=a&&u.max(a,B).length||0,c=Array(b),d=0;d<b;d++)c[d]=u.pluck(a,d);return c},u.object=function(a,b){for(var c={},d=0,e=B(a);d<e;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},u.findIndex=d(1),u.findLastIndex=d(-1),u.sortedIndex=function(a,b,c,d){c=w(c,d,1);for(var e=c(b),f=0,g=B(a);f<g;){var h=Math.floor((f+g)/2);c(a[h])<e?f=h+1:g=h}return f},u.indexOf=e(1,u.findIndex,u.sortedIndex),u.lastIndexOf=e(-1,u.findLastIndex),u.range=function(a,b,c){null==b&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;f<d;f++,a+=c)e[f]=a;return e};var F=function(a,b,c,d,e){if(!(d instanceof b))return a.apply(c,e);var f=y(a.prototype),g=a.apply(f,e);return u.isObject(g)?g:f};u.bind=function(a,b){if(r&&a.bind===r)return r.apply(a,m.call(arguments,1));if(!u.isFunction(a))throw new TypeError("Bind must be called on a function");var c=m.call(arguments,2),d=function(){return F(a,d,b,this,c.concat(m.call(arguments)))};return d},u.partial=function(a){var b=m.call(arguments,1),c=function(){for(var d=0,e=b.length,f=Array(e),g=0;g<e;g++)f[g]=b[g]===u?arguments[d++]:b[g];for(;d<arguments.length;)f.push(arguments[d++]);return F(a,c,this,this,f)};return c},u.bindAll=function(a){var b,c,d=arguments.length;if(d<=1)throw new Error("bindAll must be passed function names");for(b=1;b<d;b++)c=arguments[b],a[c]=u.bind(a[c],a);return a},u.memoize=function(a,b){var c=function(d){var e=c.cache,f=""+(b?b.apply(this,arguments):d);return u.has(e,f)||(e[f]=a.apply(this,arguments)),e[f]};return c.cache={},c},u.delay=function(a,b){var c=m.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},u.defer=u.partial(u.delay,u,1),u.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:u.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=u.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,k<=0||k>b?(g&&(clearTimeout(g),g=null),h=j,f=a.apply(d,e),g||(d=e=null)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},u.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=u.now()-g;j<b&&j>=0?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=u.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},u.wrap=function(a,b){return u.partial(b,a)},u.negate=function(a){return function(){return!a.apply(this,arguments)}},u.compose=function(){var a=arguments,b=a.length-1;return function(){for(var c=b,d=a[b].apply(this,arguments);c--;)d=a[c].call(this,d);return d}},u.after=function(a,b){return function(){if(--a<1)return b.apply(this,arguments)}},u.before=function(a,b){var c;return function(){return--a>0&&(c=b.apply(this,arguments)),a<=1&&(b=null),c}},u.once=u.partial(u.before,2);var G=!{toString:null}.propertyIsEnumerable("toString"),H=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];u.keys=function(a){if(!u.isObject(a))return[];if(q)return q(a);var b=[];for(var c in a)u.has(a,c)&&b.push(c);return G&&f(a,b),b},u.allKeys=function(a){if(!u.isObject(a))return[];var b=[];for(var c in a)b.push(c);return G&&f(a,b),b},u.values=function(a){for(var b=u.keys(a),c=b.length,d=Array(c),e=0;e<c;e++)d[e]=a[b[e]];return d},u.mapObject=function(a,b,c){b=w(b,c);for(var d,e=u.keys(a),f=e.length,g={},h=0;h<f;h++)d=e[h],g[d]=b(a[d],d,a);return g},u.pairs=function(a){for(var b=u.keys(a),c=b.length,d=Array(c),e=0;e<c;e++)d[e]=[b[e],a[b[e]]];return d},u.invert=function(a){for(var b={},c=u.keys(a),d=0,e=c.length;d<e;d++)b[a[c[d]]]=c[d];return b},u.functions=u.methods=function(a){var b=[];for(var c in a)u.isFunction(a[c])&&b.push(c);return b.sort()},u.extend=x(u.allKeys),u.extendOwn=u.assign=x(u.keys),u.findKey=function(a,b,c){b=w(b,c);for(var d,e=u.keys(a),f=0,g=e.length;f<g;f++)if(d=e[f],b(a[d],d,a))return d},u.pick=function(a,b,c){var d,e,f={},g=a;if(null==g)return f;u.isFunction(b)?(e=u.allKeys(g),d=v(b,c)):(e=E(arguments,!1,!1,1),d=function(a,b,c){return b in c},g=Object(g));for(var h=0,i=e.length;h<i;h++){var j=e[h],k=g[j];d(k,j,g)&&(f[j]=k)}return f},u.omit=function(a,b,c){if(u.isFunction(b))b=u.negate(b);else{var d=u.map(E(arguments,!1,!1,1),String);b=function(a,b){return!u.contains(d,b)}}return u.pick(a,b,c)},u.defaults=x(u.allKeys,!0),u.create=function(a,b){var c=y(a);return b&&u.extendOwn(c,b),c},u.clone=function(a){return u.isObject(a)?u.isArray(a)?a.slice():u.extend({},a):a},u.tap=function(a,b){return b(a),a},u.isMatch=function(a,b){var c=u.keys(b),d=c.length;if(null==a)return!d;for(var e=Object(a),f=0;f<d;f++){var g=c[f];if(b[g]!==e[g]||!(g in e))return!1}return!0};var I=function(a,b,c,d){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof u&&(a=a._wrapped),b instanceof u&&(b=b._wrapped);var e=n.call(a);if(e!==n.call(b))return!1;switch(e){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var f="[object Array]"===e;if(!f){if("object"!=typeof a||"object"!=typeof b)return!1;var g=a.constructor,h=b.constructor;if(g!==h&&!(u.isFunction(g)&&g instanceof g&&u.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1}c=c||[],d=d||[];for(var i=c.length;i--;)if(c[i]===a)return d[i]===b;if(c.push(a),d.push(b),f){if(i=a.length,i!==b.length)return!1;for(;i--;)if(!I(a[i],b[i],c,d))return!1}else{var j,k=u.keys(a);if(i=k.length,u.keys(b).length!==i)return!1;for(;i--;)if(j=k[i],!u.has(b,j)||!I(a[j],b[j],c,d))return!1}return c.pop(),d.pop(),!0};u.isEqual=function(a,b){return I(a,b)},u.isEmpty=function(a){return null==a||(C(a)&&(u.isArray(a)||u.isString(a)||u.isArguments(a))?0===a.length:0===u.keys(a).length)},u.isElement=function(a){return!(!a||1!==a.nodeType)},u.isArray=p||function(a){return"[object Array]"===n.call(a)},u.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},u.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(a){u["is"+a]=function(b){return n.call(b)==="[object "+a+"]"}}),u.isArguments(arguments)||(u.isArguments=function(a){return u.has(a,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(u.isFunction=function(a){return"function"==typeof a||!1}),u.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},u.isNaN=function(a){return u.isNumber(a)&&a!==+a},u.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===n.call(a)},u.isNull=function(a){return null===a},u.isUndefined=function(a){return void 0===a},u.has=function(a,b){return null!=a&&o.call(a,b)},u.noConflict=function(){return g._=h,this},u.identity=function(a){return a},u.constant=function(a){return function(){return a}},u.noop=function(){},u.property=z,u.propertyOf=function(a){return null==a?function(){}:function(b){return a[b]}},u.matcher=u.matches=function(a){return a=u.extendOwn({},a),function(b){return u.isMatch(b,a)}},u.times=function(a,b,c){var d=Array(Math.max(0,a));b=v(b,c,1);for(var e=0;e<a;e++)d[e]=b(e);return d},u.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},u.now=Date.now||function(){return(new Date).getTime()};var J={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},K=u.invert(J),L=function(a){var b=function(b){return a[b]},c="(?:"+u.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};u.escape=L(J),u.unescape=L(K),u.result=function(a,b,c){var d=null==a?void 0:a[b];return void 0===d&&(d=c),u.isFunction(d)?d.call(a):d};var M=0;u.uniqueId=function(a){var b=++M+"";return a?a+b:b},u.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var N=/(.)^/,O={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},P=/\\|'|\r|\n|\u2028|\u2029/g,Q=function(a){return"\\"+O[a]};u.template=function(a,b,c){!b&&c&&(b=c),b=u.defaults({},b,u.templateSettings);var d=RegExp([(b.escape||N).source,(b.interpolate||N).source,(b.evaluate||N).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(P,Q),e=h+b.length,c?f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?f+="'+\n((__t=("+d+"))==null?'':__t)+\n'":g&&(f+="';\n"+g+"\n__p+='"),b}),f+="';\n",b.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(b.variable||"obj","_",f)}catch(a){throw a.source=f,a}var h=function(a){return g.call(this,a,u)},i=b.variable||"obj";return h.source="function("+i+"){\n"+f+"}",h},u.chain=function(a){var b=u(a);return b._chain=!0,b};var R=function(a,b){return a._chain?u(b).chain():b};u.mixin=function(a){u.each(u.functions(a),function(b){var c=u[b]=a[b];u.prototype[b]=function(){var a=[this._wrapped];return l.apply(a,arguments),R(this,c.apply(u,a))}})},u.mixin(u),u.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=i[a];u.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!==a&&"splice"!==a||0!==c.length||delete c[0],R(this,c)}}),u.each(["concat","join","slice"],function(a){var b=i[a];u.prototype[a]=function(){return R(this,b.apply(this._wrapped,arguments))}}),u.prototype.value=function(){return this._wrapped},u.prototype.valueOf=u.prototype.toJSON=u.prototype.value,u.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return u})}).call(this)},{}]},{},[1]);
//# sourceMappingURL=client.map